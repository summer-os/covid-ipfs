{"ast":null,"code":"import { pathToRegexp } from '@qixian.cs/path-to-regexp';\nimport getFlatMenu from '../getFlatMenus/getFlatMenus';\nimport { isUrl, stripQueryStringAndHashFromPath } from '../transformRoute/transformRoute';\nexport var getMenuMatches = function getMenuMatches() {\n  var flatMenuKeys = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var path = arguments.length > 1 ? arguments[1] : undefined;\n  var exact = arguments.length > 2 ? arguments[2] : undefined;\n  return flatMenuKeys.filter(function (item) {\n    if (item === '/' && path === '/') {\n      return true;\n    }\n\n    if (item !== '/' && item !== '/*' && item && !isUrl(item)) {\n      var pathKey = stripQueryStringAndHashFromPath(item);\n\n      try {\n        // exact\n        if (exact) {\n          if (pathToRegexp(\"\".concat(pathKey)).test(path)) {\n            return true;\n          }\n        } // /a\n\n\n        if (pathToRegexp(\"\".concat(pathKey), []).test(path)) {\n          return true;\n        } // /a/b/b\n\n\n        if (pathToRegexp(\"\".concat(pathKey, \"/(.*)\")).test(path)) {\n          return true;\n        }\n      } catch (error) {// console.log(error, path);\n      }\n    }\n\n    return false;\n  }).sort(function (a, b) {\n    // 如果完全匹配放到最后面\n    if (a === path) {\n      return 10;\n    }\n\n    if (b === path) {\n      return -10;\n    }\n\n    return a.substr(1).split('/').length - b.substr(1).split('/').length;\n  });\n};\n/**\n * 获取当前的选中菜单列表\n * @param pathname\n * @param menuData\n * @returns MenuDataItem[]\n */\n\nexport var getMatchMenu = function getMatchMenu(pathname, menuData,\n/**\n * 要不要展示全部的 key\n */\nfullKeys, exact) {\n  var flatMenus = getFlatMenu(menuData);\n  var flatMenuKeys = Object.keys(flatMenus);\n  var menuPathKeys = getMenuMatches(flatMenuKeys, pathname || '/', exact);\n\n  if (!menuPathKeys || menuPathKeys.length < 1) {\n    return [];\n  }\n\n  if (!fullKeys) {\n    menuPathKeys = [menuPathKeys[menuPathKeys.length - 1]];\n  }\n\n  return menuPathKeys.map(function (menuPathKey) {\n    var menuItem = flatMenus[menuPathKey] || {\n      pro_layout_parentKeys: '',\n      key: ''\n    }; // 去重\n\n    var map = new Map();\n    var parentItems = (menuItem.pro_layout_parentKeys || []).map(function (key) {\n      if (map.has(key)) {\n        return null;\n      }\n\n      map.set(key, true);\n      return flatMenus[key];\n    }).filter(function (item) {\n      return item;\n    });\n\n    if (menuItem.key) {\n      parentItems.push(menuItem);\n    }\n\n    return parentItems;\n  }).flat(1);\n};\nexport default getMatchMenu;","map":{"version":3,"sources":["/Users/jameszow/Documents/RustWorkSpace/covid-ipfs/covid-ipfs-client/node_modules/@umijs/route-utils/es/getMatchMenu/getMatchMenu.js"],"names":["pathToRegexp","getFlatMenu","isUrl","stripQueryStringAndHashFromPath","getMenuMatches","flatMenuKeys","arguments","length","undefined","path","exact","filter","item","pathKey","concat","test","error","sort","a","b","substr","split","getMatchMenu","pathname","menuData","fullKeys","flatMenus","Object","keys","menuPathKeys","map","menuPathKey","menuItem","pro_layout_parentKeys","key","Map","parentItems","has","set","push","flat"],"mappings":"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","sourcesContent":["import { pathToRegexp } from '@qixian.cs/path-to-regexp';\nimport getFlatMenu from '../getFlatMenus/getFlatMenus';\nimport { isUrl, stripQueryStringAndHashFromPath } from '../transformRoute/transformRoute';\nexport var getMenuMatches = function getMenuMatches() {\n  var flatMenuKeys = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var path = arguments.length > 1 ? arguments[1] : undefined;\n  var exact = arguments.length > 2 ? arguments[2] : undefined;\n  return flatMenuKeys.filter(function (item) {\n    if (item === '/' && path === '/') {\n      return true;\n    }\n\n    if (item !== '/' && item !== '/*' && item && !isUrl(item)) {\n      var pathKey = stripQueryStringAndHashFromPath(item);\n\n      try {\n        // exact\n        if (exact) {\n          if (pathToRegexp(\"\".concat(pathKey)).test(path)) {\n            return true;\n          }\n        } // /a\n\n\n        if (pathToRegexp(\"\".concat(pathKey), []).test(path)) {\n          return true;\n        } // /a/b/b\n\n\n        if (pathToRegexp(\"\".concat(pathKey, \"/(.*)\")).test(path)) {\n          return true;\n        }\n      } catch (error) {// console.log(error, path);\n      }\n    }\n\n    return false;\n  }).sort(function (a, b) {\n    // 如果完全匹配放到最后面\n    if (a === path) {\n      return 10;\n    }\n\n    if (b === path) {\n      return -10;\n    }\n\n    return a.substr(1).split('/').length - b.substr(1).split('/').length;\n  });\n};\n/**\n * 获取当前的选中菜单列表\n * @param pathname\n * @param menuData\n * @returns MenuDataItem[]\n */\n\nexport var getMatchMenu = function getMatchMenu(pathname, menuData,\n/**\n * 要不要展示全部的 key\n */\nfullKeys, exact) {\n  var flatMenus = getFlatMenu(menuData);\n  var flatMenuKeys = Object.keys(flatMenus);\n  var menuPathKeys = getMenuMatches(flatMenuKeys, pathname || '/', exact);\n\n  if (!menuPathKeys || menuPathKeys.length < 1) {\n    return [];\n  }\n\n  if (!fullKeys) {\n    menuPathKeys = [menuPathKeys[menuPathKeys.length - 1]];\n  }\n\n  return menuPathKeys.map(function (menuPathKey) {\n    var menuItem = flatMenus[menuPathKey] || {\n      pro_layout_parentKeys: '',\n      key: ''\n    }; // 去重\n\n    var map = new Map();\n    var parentItems = (menuItem.pro_layout_parentKeys || []).map(function (key) {\n      if (map.has(key)) {\n        return null;\n      }\n\n      map.set(key, true);\n      return flatMenus[key];\n    }).filter(function (item) {\n      return item;\n    });\n\n    if (menuItem.key) {\n      parentItems.push(menuItem);\n    }\n\n    return parentItems;\n  }).flat(1);\n};\nexport default getMatchMenu;"]},"metadata":{},"sourceType":"module"}