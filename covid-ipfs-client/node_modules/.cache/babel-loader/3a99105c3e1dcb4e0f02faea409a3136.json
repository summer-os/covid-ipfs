{"ast":null,"code":"import \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime/helpers/esm/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport React from \"react\";\nimport { PlusOutlined } from '@ant-design/icons';\nimport { nanoid, runFunction } from '@ant-design/pro-utils';\nimport { omit } from 'lodash';\nimport { useMemo, useRef, useState } from 'react';\nimport { ProFormListItem } from './ListItem';\n\nvar ProFormListContainer = function ProFormListContainer(props) {\n  var creatorButtonProps = props.creatorButtonProps,\n      prefixCls = props.prefixCls,\n      children = props.children,\n      creatorRecord = props.creatorRecord,\n      action = props.action,\n      fields = props.fields,\n      actionGuard = props.actionGuard,\n      max = props.max,\n      fieldExtraRender = props.fieldExtraRender,\n      meta = props.meta;\n  var fieldKeyMap = useRef(new Map());\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var uuidFields = useMemo(function () {\n    return fields.map(function (field) {\n      var _fieldKeyMap$current, _fieldKeyMap$current3;\n\n      if (!((_fieldKeyMap$current = fieldKeyMap.current) === null || _fieldKeyMap$current === void 0 ? void 0 : _fieldKeyMap$current.has(field.key.toString()))) {\n        var _fieldKeyMap$current2;\n\n        (_fieldKeyMap$current2 = fieldKeyMap.current) === null || _fieldKeyMap$current2 === void 0 ? void 0 : _fieldKeyMap$current2.set(field.key.toString(), nanoid());\n      }\n\n      var uuid = (_fieldKeyMap$current3 = fieldKeyMap.current) === null || _fieldKeyMap$current3 === void 0 ? void 0 : _fieldKeyMap$current3.get(field.key.toString());\n      return _objectSpread(_objectSpread({}, field), {}, {\n        uuid: uuid\n      });\n    });\n  }, [fields]);\n  /**\n   * 根据行为守卫包装action函数\n   */\n\n  var wrapperAction = useMemo(function () {\n    var wrapAction = _objectSpread({}, action);\n\n    var count = uuidFields.length;\n\n    if (actionGuard === null || actionGuard === void 0 ? void 0 : actionGuard.beforeAddRow) {\n      wrapAction.add = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var _len,\n            rest,\n            _key,\n            success,\n            _args = arguments;\n\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                for (_len = _args.length, rest = new Array(_len), _key = 0; _key < _len; _key++) {\n                  rest[_key] = _args[_key];\n                }\n\n                _context.next = 3;\n                return actionGuard.beforeAddRow.apply(actionGuard, rest.concat([count]));\n\n              case 3:\n                success = _context.sent;\n\n                if (!success) {\n                  _context.next = 6;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", action.add.apply(action, rest));\n\n              case 6:\n                return _context.abrupt(\"return\", false);\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n    }\n\n    if (actionGuard === null || actionGuard === void 0 ? void 0 : actionGuard.beforeRemoveRow) {\n      wrapAction.remove = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var _len2,\n            rest,\n            _key2,\n            success,\n            _args2 = arguments;\n\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                for (_len2 = _args2.length, rest = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n                  rest[_key2] = _args2[_key2];\n                }\n\n                _context2.next = 3;\n                return actionGuard.beforeRemoveRow.apply(actionGuard, rest.concat([count]));\n\n              case 3:\n                success = _context2.sent;\n\n                if (!success) {\n                  _context2.next = 6;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", action.remove.apply(action, rest));\n\n              case 6:\n                return _context2.abrupt(\"return\", false);\n\n              case 7:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n    }\n\n    return wrapAction;\n  }, [action, actionGuard, uuidFields]);\n  var creatorButton = useMemo(function () {\n    if (creatorButtonProps === false || uuidFields.length === max) return null;\n\n    var _ref3 = creatorButtonProps || {},\n        _ref3$position = _ref3.position,\n        position = _ref3$position === void 0 ? 'bottom' : _ref3$position,\n        _ref3$creatorButtonTe = _ref3.creatorButtonText,\n        creatorButtonText = _ref3$creatorButtonTe === void 0 ? '添加一行数据' : _ref3$creatorButtonTe;\n\n    return /*#__PURE__*/React.createElement(_Button, _extends({\n      className: \"\".concat(prefixCls, \"-creator-button-\").concat(position),\n      type: \"dashed\",\n      loading: loading,\n      block: true,\n      icon: /*#__PURE__*/React.createElement(PlusOutlined, null)\n    }, omit(creatorButtonProps || {}, ['position', 'creatorButtonText']), {\n      onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var index;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                setLoading(true); // 如果不是从顶部开始添加，则插入的索引为当前行数\n\n                index = uuidFields.length; // 如果是顶部，加到第一个，如果不是，为空就是最后一个\n\n                if (position === 'top') index = 0;\n                _context3.next = 5;\n                return wrapperAction.add(runFunction(creatorRecord), index);\n\n              case 5:\n                setLoading(false);\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }))\n    }), creatorButtonText);\n  }, [creatorButtonProps, prefixCls, loading, wrapperAction, creatorRecord, uuidFields, max]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      width: 'max-content',\n      maxWidth: '100%',\n      minWidth: '100%'\n    }\n  }, creatorButtonProps !== false && (creatorButtonProps === null || creatorButtonProps === void 0 ? void 0 : creatorButtonProps.position) === 'top' && creatorButton, uuidFields.map(function (field, index) {\n    return /*#__PURE__*/React.createElement(ProFormListItem, _extends({}, props, {\n      key: field.uuid,\n      field: field,\n      index: index,\n      action: wrapperAction,\n      count: uuidFields.length\n    }), children);\n  }), fieldExtraRender && fieldExtraRender(wrapperAction, meta), creatorButtonProps !== false && (creatorButtonProps === null || creatorButtonProps === void 0 ? void 0 : creatorButtonProps.position) !== 'top' && creatorButton);\n};\n\nexport { ProFormListContainer };","map":{"version":3,"sources":["/Users/jameszow/Documents/RustWorkSpace/covid-ipfs/covid-ipfs-client/node_modules/@ant-design/pro-form/es/components/List/ListContainer.js"],"names":["_Button","_extends","_regeneratorRuntime","_asyncToGenerator","_objectSpread","_slicedToArray","React","PlusOutlined","nanoid","runFunction","omit","useMemo","useRef","useState","ProFormListItem","ProFormListContainer","props","creatorButtonProps","prefixCls","children","creatorRecord","action","fields","actionGuard","max","fieldExtraRender","meta","fieldKeyMap","Map","_useState","_useState2","loading","setLoading","uuidFields","map","field","_fieldKeyMap$current","_fieldKeyMap$current3","current","has","key","toString","_fieldKeyMap$current2","set","uuid","get","wrapperAction","wrapAction","count","length","beforeAddRow","add","mark","_callee","_len","rest","_key","success","_args","arguments","wrap","_callee$","_context","prev","next","Array","apply","concat","sent","abrupt","stop","beforeRemoveRow","remove","_callee2","_len2","_key2","_args2","_callee2$","_context2","creatorButton","_ref3","_ref3$position","position","_ref3$creatorButtonTe","creatorButtonText","createElement","className","type","block","icon","onClick","_callee3","index","_callee3$","_context3","style","width","maxWidth","minWidth"],"mappings":"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","sourcesContent":["import \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime/helpers/esm/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport React from \"react\";\nimport { PlusOutlined } from '@ant-design/icons';\nimport { nanoid, runFunction } from '@ant-design/pro-utils';\nimport { omit } from 'lodash';\nimport { useMemo, useRef, useState } from 'react';\nimport { ProFormListItem } from './ListItem';\n\nvar ProFormListContainer = function ProFormListContainer(props) {\n  var creatorButtonProps = props.creatorButtonProps,\n      prefixCls = props.prefixCls,\n      children = props.children,\n      creatorRecord = props.creatorRecord,\n      action = props.action,\n      fields = props.fields,\n      actionGuard = props.actionGuard,\n      max = props.max,\n      fieldExtraRender = props.fieldExtraRender,\n      meta = props.meta;\n  var fieldKeyMap = useRef(new Map());\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var uuidFields = useMemo(function () {\n    return fields.map(function (field) {\n      var _fieldKeyMap$current, _fieldKeyMap$current3;\n\n      if (!((_fieldKeyMap$current = fieldKeyMap.current) === null || _fieldKeyMap$current === void 0 ? void 0 : _fieldKeyMap$current.has(field.key.toString()))) {\n        var _fieldKeyMap$current2;\n\n        (_fieldKeyMap$current2 = fieldKeyMap.current) === null || _fieldKeyMap$current2 === void 0 ? void 0 : _fieldKeyMap$current2.set(field.key.toString(), nanoid());\n      }\n\n      var uuid = (_fieldKeyMap$current3 = fieldKeyMap.current) === null || _fieldKeyMap$current3 === void 0 ? void 0 : _fieldKeyMap$current3.get(field.key.toString());\n      return _objectSpread(_objectSpread({}, field), {}, {\n        uuid: uuid\n      });\n    });\n  }, [fields]);\n  /**\n   * 根据行为守卫包装action函数\n   */\n\n  var wrapperAction = useMemo(function () {\n    var wrapAction = _objectSpread({}, action);\n\n    var count = uuidFields.length;\n\n    if (actionGuard === null || actionGuard === void 0 ? void 0 : actionGuard.beforeAddRow) {\n      wrapAction.add = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var _len,\n            rest,\n            _key,\n            success,\n            _args = arguments;\n\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                for (_len = _args.length, rest = new Array(_len), _key = 0; _key < _len; _key++) {\n                  rest[_key] = _args[_key];\n                }\n\n                _context.next = 3;\n                return actionGuard.beforeAddRow.apply(actionGuard, rest.concat([count]));\n\n              case 3:\n                success = _context.sent;\n\n                if (!success) {\n                  _context.next = 6;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", action.add.apply(action, rest));\n\n              case 6:\n                return _context.abrupt(\"return\", false);\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n    }\n\n    if (actionGuard === null || actionGuard === void 0 ? void 0 : actionGuard.beforeRemoveRow) {\n      wrapAction.remove = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var _len2,\n            rest,\n            _key2,\n            success,\n            _args2 = arguments;\n\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                for (_len2 = _args2.length, rest = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n                  rest[_key2] = _args2[_key2];\n                }\n\n                _context2.next = 3;\n                return actionGuard.beforeRemoveRow.apply(actionGuard, rest.concat([count]));\n\n              case 3:\n                success = _context2.sent;\n\n                if (!success) {\n                  _context2.next = 6;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", action.remove.apply(action, rest));\n\n              case 6:\n                return _context2.abrupt(\"return\", false);\n\n              case 7:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n    }\n\n    return wrapAction;\n  }, [action, actionGuard, uuidFields]);\n  var creatorButton = useMemo(function () {\n    if (creatorButtonProps === false || uuidFields.length === max) return null;\n\n    var _ref3 = creatorButtonProps || {},\n        _ref3$position = _ref3.position,\n        position = _ref3$position === void 0 ? 'bottom' : _ref3$position,\n        _ref3$creatorButtonTe = _ref3.creatorButtonText,\n        creatorButtonText = _ref3$creatorButtonTe === void 0 ? '添加一行数据' : _ref3$creatorButtonTe;\n\n    return /*#__PURE__*/React.createElement(_Button, _extends({\n      className: \"\".concat(prefixCls, \"-creator-button-\").concat(position),\n      type: \"dashed\",\n      loading: loading,\n      block: true,\n      icon: /*#__PURE__*/React.createElement(PlusOutlined, null)\n    }, omit(creatorButtonProps || {}, ['position', 'creatorButtonText']), {\n      onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var index;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                setLoading(true); // 如果不是从顶部开始添加，则插入的索引为当前行数\n\n                index = uuidFields.length; // 如果是顶部，加到第一个，如果不是，为空就是最后一个\n\n                if (position === 'top') index = 0;\n                _context3.next = 5;\n                return wrapperAction.add(runFunction(creatorRecord), index);\n\n              case 5:\n                setLoading(false);\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }))\n    }), creatorButtonText);\n  }, [creatorButtonProps, prefixCls, loading, wrapperAction, creatorRecord, uuidFields, max]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      width: 'max-content',\n      maxWidth: '100%',\n      minWidth: '100%'\n    }\n  }, creatorButtonProps !== false && (creatorButtonProps === null || creatorButtonProps === void 0 ? void 0 : creatorButtonProps.position) === 'top' && creatorButton, uuidFields.map(function (field, index) {\n    return /*#__PURE__*/React.createElement(ProFormListItem, _extends({}, props, {\n      key: field.uuid,\n      field: field,\n      index: index,\n      action: wrapperAction,\n      count: uuidFields.length\n    }), children);\n  }), fieldExtraRender && fieldExtraRender(wrapperAction, meta), creatorButtonProps !== false && (creatorButtonProps === null || creatorButtonProps === void 0 ? void 0 : creatorButtonProps.position) !== 'top' && creatorButton);\n};\n\nexport { ProFormListContainer };"]},"metadata":{},"sourceType":"module"}