{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/helpers/esm/regeneratorRuntime\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nvar _excluded = [\"data\", \"success\", \"total\"];\nimport { runFunction, useDebounceFn, useDeepCompareEffect, useMountMergeState, usePrevious, useRefFunction } from '@ant-design/pro-utils';\nimport { useEffect, useLayoutEffect, useRef } from 'react';\nimport { postDataPipeline } from './utils/index';\n/**\n * 组合用户的配置和默认值\n *\n * @param param0\n */\n\nvar mergeOptionAndPageInfo = function mergeOptionAndPageInfo(_ref) {\n  var pageInfo = _ref.pageInfo;\n\n  if (pageInfo) {\n    var current = pageInfo.current,\n        defaultCurrent = pageInfo.defaultCurrent,\n        pageSize = pageInfo.pageSize,\n        defaultPageSize = pageInfo.defaultPageSize;\n    return {\n      current: current || defaultCurrent || 1,\n      total: 0,\n      pageSize: pageSize || defaultPageSize || 20\n    };\n  }\n\n  return {\n    current: 1,\n    total: 0,\n    pageSize: 20\n  };\n};\n\nvar useFetchData = function useFetchData(getData, defaultData, options) {\n  var umountRef = useRef(false);\n\n  var _ref2 = options || {},\n      onLoad = _ref2.onLoad,\n      manual = _ref2.manual,\n      polling = _ref2.polling,\n      onRequestError = _ref2.onRequestError,\n      _ref2$debounceTime = _ref2.debounceTime,\n      debounceTime = _ref2$debounceTime === void 0 ? 20 : _ref2$debounceTime;\n  /** 是否首次加载的指示器 */\n\n\n  var manualRequestRef = useRef(manual);\n  /** 轮询的setTime ID 存储 */\n\n  var pollingSetTimeRef = useRef();\n\n  var _useMountMergeState = useMountMergeState(defaultData, {\n    value: options === null || options === void 0 ? void 0 : options.dataSource,\n    onChange: options === null || options === void 0 ? void 0 : options.onDataSourceChange\n  }),\n      _useMountMergeState2 = _slicedToArray(_useMountMergeState, 2),\n      list = _useMountMergeState2[0],\n      setList = _useMountMergeState2[1];\n\n  var _useMountMergeState3 = useMountMergeState(false, {\n    value: options === null || options === void 0 ? void 0 : options.loading,\n    onChange: options === null || options === void 0 ? void 0 : options.onLoadingChange\n  }),\n      _useMountMergeState4 = _slicedToArray(_useMountMergeState3, 2),\n      tableLoading = _useMountMergeState4[0],\n      setLoading = _useMountMergeState4[1];\n\n  var requesting = useRef(false);\n\n  var _useMountMergeState5 = useMountMergeState(function () {\n    return mergeOptionAndPageInfo(options);\n  }, {\n    onChange: options === null || options === void 0 ? void 0 : options.onPageInfoChange\n  }),\n      _useMountMergeState6 = _slicedToArray(_useMountMergeState5, 2),\n      pageInfo = _useMountMergeState6[0],\n      setPageInfoState = _useMountMergeState6[1];\n\n  var _setPageInfo = useRefFunction(function (changePageInfo) {\n    if (changePageInfo.current !== pageInfo.current || changePageInfo.pageSize !== pageInfo.pageSize || changePageInfo.total !== pageInfo.total) {\n      setPageInfoState(changePageInfo);\n    }\n  });\n\n  var _useMountMergeState7 = useMountMergeState(false),\n      _useMountMergeState8 = _slicedToArray(_useMountMergeState7, 2),\n      pollingLoading = _useMountMergeState8[0],\n      setPollingLoading = _useMountMergeState8[1]; // Batching update  https://github.com/facebook/react/issues/14259\n\n\n  var setDataAndLoading = function setDataAndLoading(newData, dataTotal) {\n    setList(newData);\n\n    if ((pageInfo === null || pageInfo === void 0 ? void 0 : pageInfo.total) !== dataTotal) {\n      _setPageInfo(_objectSpread(_objectSpread({}, pageInfo), {}, {\n        total: dataTotal || newData.length\n      }));\n    }\n  }; // pre state\n\n\n  var prePage = usePrevious(pageInfo === null || pageInfo === void 0 ? void 0 : pageInfo.current);\n  var prePageSize = usePrevious(pageInfo === null || pageInfo === void 0 ? void 0 : pageInfo.pageSize);\n  var prePolling = usePrevious(polling);\n\n  var _ref3 = options || {},\n      _ref3$effects = _ref3.effects,\n      effects = _ref3$effects === void 0 ? [] : _ref3$effects;\n  /**\n   * 不这样做会导致状态不更新\n   *\n   * https://github.com/ant-design/pro-components/issues/4390\n   */\n\n\n  var requestFinally = useRefFunction(function () {\n    requestAnimationFrame(function () {\n      setLoading(false);\n      setPollingLoading(false);\n    });\n  });\n  /** 请求数据 */\n\n  var fetchList = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(isPolling) {\n      var _ref5, pageSize, current, pageParams, _ref6, _ref6$data, data, success, _ref6$total, total, rest, responseData;\n\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(tableLoading || requesting.current || !getData)) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\", []);\n\n            case 2:\n              if (!manualRequestRef.current) {\n                _context.next = 5;\n                break;\n              }\n\n              manualRequestRef.current = false;\n              return _context.abrupt(\"return\", []);\n\n            case 5:\n              if (!isPolling) {\n                setLoading(true);\n              } else {\n                setPollingLoading(true);\n              }\n\n              requesting.current = true;\n              _ref5 = pageInfo || {}, pageSize = _ref5.pageSize, current = _ref5.current;\n              _context.prev = 8;\n              pageParams = (options === null || options === void 0 ? void 0 : options.pageInfo) !== false ? {\n                current: current,\n                pageSize: pageSize\n              } : undefined;\n              _context.next = 12;\n              return getData(pageParams);\n\n            case 12:\n              _context.t0 = _context.sent;\n\n              if (_context.t0) {\n                _context.next = 15;\n                break;\n              }\n\n              _context.t0 = {};\n\n            case 15:\n              _ref6 = _context.t0;\n              _ref6$data = _ref6.data;\n              data = _ref6$data === void 0 ? [] : _ref6$data;\n              success = _ref6.success;\n              _ref6$total = _ref6.total;\n              total = _ref6$total === void 0 ? 0 : _ref6$total;\n              rest = _objectWithoutProperties(_ref6, _excluded);\n\n              if (!(success === false)) {\n                _context.next = 24;\n                break;\n              }\n\n              return _context.abrupt(\"return\", []);\n\n            case 24:\n              responseData = postDataPipeline(data, [options.postData].filter(function (item) {\n                return item;\n              }));\n              setDataAndLoading(responseData, total);\n              onLoad === null || onLoad === void 0 ? void 0 : onLoad(responseData, rest);\n              return _context.abrupt(\"return\", responseData);\n\n            case 30:\n              _context.prev = 30;\n              _context.t1 = _context[\"catch\"](8);\n\n              if (!(onRequestError === undefined)) {\n                _context.next = 34;\n                break;\n              }\n\n              throw new Error(_context.t1);\n\n            case 34:\n              if (list === undefined) setList([]);\n              onRequestError(_context.t1);\n\n            case 36:\n              _context.prev = 36;\n              requesting.current = false;\n              requestFinally();\n              return _context.finish(36);\n\n            case 40:\n              return _context.abrupt(\"return\", []);\n\n            case 41:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[8, 30, 36, 40]]);\n    }));\n\n    return function fetchList(_x) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var fetchListDebounce = useDebounceFn( /*#__PURE__*/function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(isPolling) {\n      var msg, needPolling;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (pollingSetTimeRef.current) {\n                clearTimeout(pollingSetTimeRef.current);\n              }\n\n              _context2.next = 3;\n              return fetchList(isPolling);\n\n            case 3:\n              msg = _context2.sent; // 把判断要不要轮询的逻辑放到后面来这样可以保证数据是根据当前来\n              // 放到请求前面会导致数据是上一次的\n\n              needPolling = runFunction(polling, msg); // 如果需要轮询，搞个一段时间后执行\n              // 如果解除了挂载，删除一下\n\n              if (needPolling && !umountRef.current) {\n                pollingSetTimeRef.current = setTimeout(function () {\n                  fetchListDebounce.run(needPolling); // 这里判断最小要2000ms，不然一直loading\n                }, Math.max(needPolling, 2000));\n              }\n\n              return _context2.abrupt(\"return\", msg);\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x2) {\n      return _ref7.apply(this, arguments);\n    };\n  }(), debounceTime || 10); // 如果轮询结束了，直接销毁定时器\n\n  useEffect(function () {\n    if (!polling) {\n      clearTimeout(pollingSetTimeRef.current);\n    }\n\n    if (!prePolling && polling) {\n      fetchListDebounce.run(true);\n    }\n\n    return function () {\n      clearTimeout(pollingSetTimeRef.current);\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [polling]);\n  useLayoutEffect(function () {\n    umountRef.current = false;\n    return function () {\n      umountRef.current = true;\n    };\n  }, []);\n  /** PageIndex 改变的时候自动刷新 */\n\n  useEffect(function () {\n    var _ref8 = pageInfo || {},\n        current = _ref8.current,\n        pageSize = _ref8.pageSize; // 如果上次的页码为空或者两次页码等于是没必要查询的\n    // 如果 pageSize 发生变化是需要查询的，所以又加了 prePageSize\n\n\n    if ((!prePage || prePage === current) && (!prePageSize || prePageSize === pageSize)) {\n      return;\n    }\n\n    if (options.pageInfo && list && (list === null || list === void 0 ? void 0 : list.length) > pageSize || 0) {\n      return;\n    } // 如果 list 的长度大于 pageSize 的长度\n    // 说明是一个假分页\n    // (pageIndex - 1 || 1) 至少要第一页\n    // 在第一页大于 10\n    // 第二页也应该是大于 10\n\n\n    if (current !== undefined && list && list.length <= pageSize) {\n      fetchListDebounce.run(false);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [pageInfo === null || pageInfo === void 0 ? void 0 : pageInfo.current]); // pageSize 修改后返回第一页\n\n  useEffect(function () {\n    if (!prePageSize) {\n      return;\n    }\n\n    fetchListDebounce.run(false); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [pageInfo === null || pageInfo === void 0 ? void 0 : pageInfo.pageSize]);\n  useDeepCompareEffect(function () {\n    fetchListDebounce.run(false);\n\n    if (!manual) {\n      manualRequestRef.current = false;\n    }\n\n    return function () {\n      fetchListDebounce.cancel();\n    };\n  }, [].concat(_toConsumableArray(effects), [manual]));\n  return {\n    dataSource: list,\n    setDataSource: setList,\n    loading: tableLoading,\n    reload: function () {\n      var _reload = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return fetchListDebounce.run(false);\n\n              case 2:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      function reload() {\n        return _reload.apply(this, arguments);\n      }\n\n      return reload;\n    }(),\n    pageInfo: pageInfo,\n    pollingLoading: pollingLoading,\n    reset: function () {\n      var _reset = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var _ref9, optionPageInfo, _ref10, _ref10$defaultCurrent, defaultCurrent, _ref10$defaultPageSiz, defaultPageSize, initialPageInfo;\n\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _ref9 = options || {}, optionPageInfo = _ref9.pageInfo;\n                _ref10 = optionPageInfo || {}, _ref10$defaultCurrent = _ref10.defaultCurrent, defaultCurrent = _ref10$defaultCurrent === void 0 ? 1 : _ref10$defaultCurrent, _ref10$defaultPageSiz = _ref10.defaultPageSize, defaultPageSize = _ref10$defaultPageSiz === void 0 ? 20 : _ref10$defaultPageSiz;\n                initialPageInfo = {\n                  current: defaultCurrent,\n                  total: 0,\n                  pageSize: defaultPageSize\n                };\n\n                _setPageInfo(initialPageInfo);\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      function reset() {\n        return _reset.apply(this, arguments);\n      }\n\n      return reset;\n    }(),\n    setPageInfo: function () {\n      var _setPageInfo2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(info) {\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _setPageInfo(_objectSpread(_objectSpread({}, pageInfo), info));\n\n              case 1:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n\n      function setPageInfo(_x3) {\n        return _setPageInfo2.apply(this, arguments);\n      }\n\n      return setPageInfo;\n    }()\n  };\n};\n\nexport default useFetchData;","map":{"version":3,"sources":["/Users/jameszow/Documents/RustWorkSpace/covid-ipfs/covid-ipfs-client/node_modules/@ant-design/pro-table/es/useFetchData.js"],"names":["_toConsumableArray","_regeneratorRuntime","_objectWithoutProperties","_asyncToGenerator","_objectSpread","_slicedToArray","_excluded","runFunction","useDebounceFn","useDeepCompareEffect","useMountMergeState","usePrevious","useRefFunction","useEffect","useLayoutEffect","useRef","postDataPipeline","mergeOptionAndPageInfo","_ref","pageInfo","current","defaultCurrent","pageSize","defaultPageSize","total","useFetchData","getData","defaultData","options","umountRef","_ref2","onLoad","manual","polling","onRequestError","_ref2$debounceTime","debounceTime","manualRequestRef","pollingSetTimeRef","_useMountMergeState","value","dataSource","onChange","onDataSourceChange","_useMountMergeState2","list","setList","_useMountMergeState3","loading","onLoadingChange","_useMountMergeState4","tableLoading","setLoading","requesting","_useMountMergeState5","onPageInfoChange","_useMountMergeState6","setPageInfoState","_setPageInfo","changePageInfo","_useMountMergeState7","_useMountMergeState8","pollingLoading","setPollingLoading","setDataAndLoading","newData","dataTotal","length","prePage","prePageSize","prePolling","_ref3","_ref3$effects","effects","requestFinally","requestAnimationFrame","fetchList","_ref4","mark","_callee","isPolling","_ref5","pageParams","_ref6","_ref6$data","data","success","_ref6$total","rest","responseData","wrap","_callee$","_context","prev","next","abrupt","undefined","t0","sent","postData","filter","item","t1","Error","finish","stop","_x","apply","arguments","fetchListDebounce","_ref7","_callee2","msg","needPolling","_callee2$","_context2","clearTimeout","setTimeout","run","Math","max","_x2","_ref8","cancel","concat","setDataSource","reload","_reload","_callee3","_callee3$","_context3","reset","_reset","_callee4","_ref9","optionPageInfo","_ref10","_ref10$defaultCurrent","_ref10$defaultPageSiz","initialPageInfo","_callee4$","_context4","setPageInfo","_setPageInfo2","_callee5","info","_callee5$","_context5","_x3"],"mappings":"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","sourcesContent":["import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/helpers/esm/regeneratorRuntime\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nvar _excluded = [\"data\", \"success\", \"total\"];\nimport { runFunction, useDebounceFn, useDeepCompareEffect, useMountMergeState, usePrevious, useRefFunction } from '@ant-design/pro-utils';\nimport { useEffect, useLayoutEffect, useRef } from 'react';\nimport { postDataPipeline } from './utils/index';\n/**\n * 组合用户的配置和默认值\n *\n * @param param0\n */\n\nvar mergeOptionAndPageInfo = function mergeOptionAndPageInfo(_ref) {\n  var pageInfo = _ref.pageInfo;\n\n  if (pageInfo) {\n    var current = pageInfo.current,\n        defaultCurrent = pageInfo.defaultCurrent,\n        pageSize = pageInfo.pageSize,\n        defaultPageSize = pageInfo.defaultPageSize;\n    return {\n      current: current || defaultCurrent || 1,\n      total: 0,\n      pageSize: pageSize || defaultPageSize || 20\n    };\n  }\n\n  return {\n    current: 1,\n    total: 0,\n    pageSize: 20\n  };\n};\n\nvar useFetchData = function useFetchData(getData, defaultData, options) {\n  var umountRef = useRef(false);\n\n  var _ref2 = options || {},\n      onLoad = _ref2.onLoad,\n      manual = _ref2.manual,\n      polling = _ref2.polling,\n      onRequestError = _ref2.onRequestError,\n      _ref2$debounceTime = _ref2.debounceTime,\n      debounceTime = _ref2$debounceTime === void 0 ? 20 : _ref2$debounceTime;\n  /** 是否首次加载的指示器 */\n\n\n  var manualRequestRef = useRef(manual);\n  /** 轮询的setTime ID 存储 */\n\n  var pollingSetTimeRef = useRef();\n\n  var _useMountMergeState = useMountMergeState(defaultData, {\n    value: options === null || options === void 0 ? void 0 : options.dataSource,\n    onChange: options === null || options === void 0 ? void 0 : options.onDataSourceChange\n  }),\n      _useMountMergeState2 = _slicedToArray(_useMountMergeState, 2),\n      list = _useMountMergeState2[0],\n      setList = _useMountMergeState2[1];\n\n  var _useMountMergeState3 = useMountMergeState(false, {\n    value: options === null || options === void 0 ? void 0 : options.loading,\n    onChange: options === null || options === void 0 ? void 0 : options.onLoadingChange\n  }),\n      _useMountMergeState4 = _slicedToArray(_useMountMergeState3, 2),\n      tableLoading = _useMountMergeState4[0],\n      setLoading = _useMountMergeState4[1];\n\n  var requesting = useRef(false);\n\n  var _useMountMergeState5 = useMountMergeState(function () {\n    return mergeOptionAndPageInfo(options);\n  }, {\n    onChange: options === null || options === void 0 ? void 0 : options.onPageInfoChange\n  }),\n      _useMountMergeState6 = _slicedToArray(_useMountMergeState5, 2),\n      pageInfo = _useMountMergeState6[0],\n      setPageInfoState = _useMountMergeState6[1];\n\n  var _setPageInfo = useRefFunction(function (changePageInfo) {\n    if (changePageInfo.current !== pageInfo.current || changePageInfo.pageSize !== pageInfo.pageSize || changePageInfo.total !== pageInfo.total) {\n      setPageInfoState(changePageInfo);\n    }\n  });\n\n  var _useMountMergeState7 = useMountMergeState(false),\n      _useMountMergeState8 = _slicedToArray(_useMountMergeState7, 2),\n      pollingLoading = _useMountMergeState8[0],\n      setPollingLoading = _useMountMergeState8[1]; // Batching update  https://github.com/facebook/react/issues/14259\n\n\n  var setDataAndLoading = function setDataAndLoading(newData, dataTotal) {\n    setList(newData);\n\n    if ((pageInfo === null || pageInfo === void 0 ? void 0 : pageInfo.total) !== dataTotal) {\n      _setPageInfo(_objectSpread(_objectSpread({}, pageInfo), {}, {\n        total: dataTotal || newData.length\n      }));\n    }\n  }; // pre state\n\n\n  var prePage = usePrevious(pageInfo === null || pageInfo === void 0 ? void 0 : pageInfo.current);\n  var prePageSize = usePrevious(pageInfo === null || pageInfo === void 0 ? void 0 : pageInfo.pageSize);\n  var prePolling = usePrevious(polling);\n\n  var _ref3 = options || {},\n      _ref3$effects = _ref3.effects,\n      effects = _ref3$effects === void 0 ? [] : _ref3$effects;\n  /**\n   * 不这样做会导致状态不更新\n   *\n   * https://github.com/ant-design/pro-components/issues/4390\n   */\n\n\n  var requestFinally = useRefFunction(function () {\n    requestAnimationFrame(function () {\n      setLoading(false);\n      setPollingLoading(false);\n    });\n  });\n  /** 请求数据 */\n\n  var fetchList = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(isPolling) {\n      var _ref5, pageSize, current, pageParams, _ref6, _ref6$data, data, success, _ref6$total, total, rest, responseData;\n\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(tableLoading || requesting.current || !getData)) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\", []);\n\n            case 2:\n              if (!manualRequestRef.current) {\n                _context.next = 5;\n                break;\n              }\n\n              manualRequestRef.current = false;\n              return _context.abrupt(\"return\", []);\n\n            case 5:\n              if (!isPolling) {\n                setLoading(true);\n              } else {\n                setPollingLoading(true);\n              }\n\n              requesting.current = true;\n              _ref5 = pageInfo || {}, pageSize = _ref5.pageSize, current = _ref5.current;\n              _context.prev = 8;\n              pageParams = (options === null || options === void 0 ? void 0 : options.pageInfo) !== false ? {\n                current: current,\n                pageSize: pageSize\n              } : undefined;\n              _context.next = 12;\n              return getData(pageParams);\n\n            case 12:\n              _context.t0 = _context.sent;\n\n              if (_context.t0) {\n                _context.next = 15;\n                break;\n              }\n\n              _context.t0 = {};\n\n            case 15:\n              _ref6 = _context.t0;\n              _ref6$data = _ref6.data;\n              data = _ref6$data === void 0 ? [] : _ref6$data;\n              success = _ref6.success;\n              _ref6$total = _ref6.total;\n              total = _ref6$total === void 0 ? 0 : _ref6$total;\n              rest = _objectWithoutProperties(_ref6, _excluded);\n\n              if (!(success === false)) {\n                _context.next = 24;\n                break;\n              }\n\n              return _context.abrupt(\"return\", []);\n\n            case 24:\n              responseData = postDataPipeline(data, [options.postData].filter(function (item) {\n                return item;\n              }));\n              setDataAndLoading(responseData, total);\n              onLoad === null || onLoad === void 0 ? void 0 : onLoad(responseData, rest);\n              return _context.abrupt(\"return\", responseData);\n\n            case 30:\n              _context.prev = 30;\n              _context.t1 = _context[\"catch\"](8);\n\n              if (!(onRequestError === undefined)) {\n                _context.next = 34;\n                break;\n              }\n\n              throw new Error(_context.t1);\n\n            case 34:\n              if (list === undefined) setList([]);\n              onRequestError(_context.t1);\n\n            case 36:\n              _context.prev = 36;\n              requesting.current = false;\n              requestFinally();\n              return _context.finish(36);\n\n            case 40:\n              return _context.abrupt(\"return\", []);\n\n            case 41:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[8, 30, 36, 40]]);\n    }));\n\n    return function fetchList(_x) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var fetchListDebounce = useDebounceFn( /*#__PURE__*/function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(isPolling) {\n      var msg, needPolling;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (pollingSetTimeRef.current) {\n                clearTimeout(pollingSetTimeRef.current);\n              }\n\n              _context2.next = 3;\n              return fetchList(isPolling);\n\n            case 3:\n              msg = _context2.sent;\n              // 把判断要不要轮询的逻辑放到后面来这样可以保证数据是根据当前来\n              // 放到请求前面会导致数据是上一次的\n              needPolling = runFunction(polling, msg); // 如果需要轮询，搞个一段时间后执行\n              // 如果解除了挂载，删除一下\n\n              if (needPolling && !umountRef.current) {\n                pollingSetTimeRef.current = setTimeout(function () {\n                  fetchListDebounce.run(needPolling); // 这里判断最小要2000ms，不然一直loading\n                }, Math.max(needPolling, 2000));\n              }\n\n              return _context2.abrupt(\"return\", msg);\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x2) {\n      return _ref7.apply(this, arguments);\n    };\n  }(), debounceTime || 10); // 如果轮询结束了，直接销毁定时器\n\n  useEffect(function () {\n    if (!polling) {\n      clearTimeout(pollingSetTimeRef.current);\n    }\n\n    if (!prePolling && polling) {\n      fetchListDebounce.run(true);\n    }\n\n    return function () {\n      clearTimeout(pollingSetTimeRef.current);\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [polling]);\n  useLayoutEffect(function () {\n    umountRef.current = false;\n    return function () {\n      umountRef.current = true;\n    };\n  }, []);\n  /** PageIndex 改变的时候自动刷新 */\n\n  useEffect(function () {\n    var _ref8 = pageInfo || {},\n        current = _ref8.current,\n        pageSize = _ref8.pageSize; // 如果上次的页码为空或者两次页码等于是没必要查询的\n    // 如果 pageSize 发生变化是需要查询的，所以又加了 prePageSize\n\n\n    if ((!prePage || prePage === current) && (!prePageSize || prePageSize === pageSize)) {\n      return;\n    }\n\n    if (options.pageInfo && list && (list === null || list === void 0 ? void 0 : list.length) > pageSize || 0) {\n      return;\n    } // 如果 list 的长度大于 pageSize 的长度\n    // 说明是一个假分页\n    // (pageIndex - 1 || 1) 至少要第一页\n    // 在第一页大于 10\n    // 第二页也应该是大于 10\n\n\n    if (current !== undefined && list && list.length <= pageSize) {\n      fetchListDebounce.run(false);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [pageInfo === null || pageInfo === void 0 ? void 0 : pageInfo.current]); // pageSize 修改后返回第一页\n\n  useEffect(function () {\n    if (!prePageSize) {\n      return;\n    }\n\n    fetchListDebounce.run(false); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [pageInfo === null || pageInfo === void 0 ? void 0 : pageInfo.pageSize]);\n  useDeepCompareEffect(function () {\n    fetchListDebounce.run(false);\n\n    if (!manual) {\n      manualRequestRef.current = false;\n    }\n\n    return function () {\n      fetchListDebounce.cancel();\n    };\n  }, [].concat(_toConsumableArray(effects), [manual]));\n  return {\n    dataSource: list,\n    setDataSource: setList,\n    loading: tableLoading,\n    reload: function () {\n      var _reload = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return fetchListDebounce.run(false);\n\n              case 2:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      function reload() {\n        return _reload.apply(this, arguments);\n      }\n\n      return reload;\n    }(),\n    pageInfo: pageInfo,\n    pollingLoading: pollingLoading,\n    reset: function () {\n      var _reset = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var _ref9, optionPageInfo, _ref10, _ref10$defaultCurrent, defaultCurrent, _ref10$defaultPageSiz, defaultPageSize, initialPageInfo;\n\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _ref9 = options || {}, optionPageInfo = _ref9.pageInfo;\n                _ref10 = optionPageInfo || {}, _ref10$defaultCurrent = _ref10.defaultCurrent, defaultCurrent = _ref10$defaultCurrent === void 0 ? 1 : _ref10$defaultCurrent, _ref10$defaultPageSiz = _ref10.defaultPageSize, defaultPageSize = _ref10$defaultPageSiz === void 0 ? 20 : _ref10$defaultPageSiz;\n                initialPageInfo = {\n                  current: defaultCurrent,\n                  total: 0,\n                  pageSize: defaultPageSize\n                };\n\n                _setPageInfo(initialPageInfo);\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      function reset() {\n        return _reset.apply(this, arguments);\n      }\n\n      return reset;\n    }(),\n    setPageInfo: function () {\n      var _setPageInfo2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(info) {\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _setPageInfo(_objectSpread(_objectSpread({}, pageInfo), info));\n\n              case 1:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n\n      function setPageInfo(_x3) {\n        return _setPageInfo2.apply(this, arguments);\n      }\n\n      return setPageInfo;\n    }()\n  };\n};\n\nexport default useFetchData;"]},"metadata":{},"sourceType":"module"}