{"ast":null,"code":"import \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _regeneratorRuntime from \"@babel/runtime/helpers/esm/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nvar _excluded = [\"onTableChange\", \"maxLength\", \"formItemProps\", \"recordCreatorProps\", \"rowKey\", \"controlled\", \"defaultValue\", \"onChange\", \"editableFormRef\"],\n    _excluded2 = [\"record\", \"position\", \"creatorButtonText\", \"newRecordType\", \"parentKey\", \"style\"];\nimport { PlusOutlined } from '@ant-design/icons';\nimport { ProFormDependency } from '@ant-design/pro-form';\nimport { isDeepEqualReact, runFunction, usePrevious, useRefFunction } from '@ant-design/pro-utils';\nimport { Field } from 'rc-field-form';\nimport useMergedState from \"rc-util/es/hooks/useMergedState\";\nimport get from \"rc-util/es/utils/get\";\nimport set from \"rc-util/es/utils/set\";\nimport React, { useContext, useEffect, useImperativeHandle, useMemo, useRef } from 'react';\nimport ProTable from '../../Table';\nvar EditableTableActionContext = /*#__PURE__*/React.createContext(undefined);\n/** 可编辑表格的按钮 */\n\nfunction RecordCreator(props) {\n  var children = props.children,\n      record = props.record,\n      position = props.position,\n      newRecordType = props.newRecordType,\n      parentKey = props.parentKey;\n  var actionRef = useContext(EditableTableActionContext);\n  return /*#__PURE__*/React.cloneElement(children, _objectSpread(_objectSpread({}, children.props), {}, {\n    onClick: function () {\n      var _onClick = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(e) {\n        var _children$props$onCli, _children$props, _actionRef$current;\n\n        var isOk;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return (_children$props$onCli = (_children$props = children.props).onClick) === null || _children$props$onCli === void 0 ? void 0 : _children$props$onCli.call(_children$props, e);\n\n              case 2:\n                isOk = _context.sent;\n\n                if (!(isOk === false)) {\n                  _context.next = 5;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 5:\n                actionRef === null || actionRef === void 0 ? void 0 : (_actionRef$current = actionRef.current) === null || _actionRef$current === void 0 ? void 0 : _actionRef$current.addEditRecord(record, {\n                  position: position,\n                  newRecordType: newRecordType,\n                  parentKey: parentKey\n                });\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function onClick(_x) {\n        return _onClick.apply(this, arguments);\n      }\n\n      return onClick;\n    }()\n  }));\n}\n/**\n * 可以直接放到 Form 中的可编辑表格\n *\n * @param props\n */\n\n\nfunction EditableTable(props) {\n  var _props$editable2, _props$editable4;\n\n  var onTableChange = props.onTableChange,\n      maxLength = props.maxLength,\n      formItemProps = props.formItemProps,\n      recordCreatorProps = props.recordCreatorProps,\n      rowKey = props.rowKey,\n      controlled = props.controlled,\n      defaultValue = props.defaultValue,\n      onChange = props.onChange,\n      editableFormRef = props.editableFormRef,\n      rest = _objectWithoutProperties(props, _excluded);\n\n  var preData = usePrevious(props.value);\n  var actionRef = useRef();\n  var formRef = useRef(); // 设置 ref\n\n  useImperativeHandle(rest.actionRef, function () {\n    return actionRef.current;\n  });\n\n  var _useMergedState = useMergedState(function () {\n    return props.value || defaultValue || [];\n  }, {\n    value: props.value,\n    onChange: props.onChange\n  }),\n      _useMergedState2 = _slicedToArray(_useMergedState, 2),\n      value = _useMergedState2[0],\n      setValue = _useMergedState2[1];\n\n  var getRowKey = React.useMemo(function () {\n    if (typeof rowKey === 'function') {\n      return rowKey;\n    }\n\n    return function (record, index) {\n      return record[rowKey] || index;\n    };\n  }, [rowKey]);\n  /**\n   * 根据不同的情况返回不同的 rowKey\n   * @param finlayRowKey\n   * @returns string | number\n   */\n\n  var coverRowKey = function coverRowKey(finlayRowKey) {\n    /**\n     * 如果是 prop.name 的模式，就需要把行号转化成具体的rowKey。\n     */\n    if (typeof finlayRowKey === 'number' && !props.name) {\n      if (finlayRowKey >= value.length) return finlayRowKey;\n      var rowData = value === null || value === void 0 ? void 0 : value.at(finlayRowKey);\n      return getRowKey === null || getRowKey === void 0 ? void 0 : getRowKey(rowData, finlayRowKey);\n    }\n    /**\n     * 如果是 prop.name 的模式，就直接返回行号\n     */\n\n\n    if ((typeof finlayRowKey === 'string' || finlayRowKey >= value.length) && props.name) {\n      var rowIndex = value.findIndex(function (item, index) {\n        var _getRowKey;\n\n        return (getRowKey === null || getRowKey === void 0 ? void 0 : (_getRowKey = getRowKey(item, index)) === null || _getRowKey === void 0 ? void 0 : _getRowKey.toString()) === (finlayRowKey === null || finlayRowKey === void 0 ? void 0 : finlayRowKey.toString());\n      });\n      return rowIndex;\n    }\n\n    return finlayRowKey;\n  }; // 设置 editableFormRef\n\n\n  useImperativeHandle(editableFormRef, function () {\n    /**\n     * 获取一行数据的\n     * @param rowIndex\n     * @returns T | undefined\n     */\n    var getRowData = function getRowData(rowIndex) {\n      var _finlayRowKey$toStrin, _formRef$current;\n\n      if (rowIndex == undefined) {\n        throw new Error('rowIndex is required');\n      }\n\n      var finlayRowKey = coverRowKey(rowIndex);\n      var rowKeyName = [props.name, (_finlayRowKey$toStrin = finlayRowKey === null || finlayRowKey === void 0 ? void 0 : finlayRowKey.toString()) !== null && _finlayRowKey$toStrin !== void 0 ? _finlayRowKey$toStrin : ''].flat(1).filter(Boolean);\n      return (_formRef$current = formRef.current) === null || _formRef$current === void 0 ? void 0 : _formRef$current.getFieldValue(rowKeyName);\n    };\n    /**\n     * 获取整个 table 的数据\n     * @returns T[] | undefined\n     */\n\n\n    var getRowsData = function getRowsData() {\n      var _formRef$current3;\n\n      var rowKeyName = [props.name].flat(1).filter(Boolean);\n\n      if (Array.isArray(rowKeyName) && rowKeyName.length === 0) {\n        var _formRef$current2;\n\n        var rowData = (_formRef$current2 = formRef.current) === null || _formRef$current2 === void 0 ? void 0 : _formRef$current2.getFieldsValue();\n        if (Array.isArray(rowData)) return rowData;\n        return Object.keys(rowData).map(function (key) {\n          return rowData[key];\n        });\n      }\n\n      return (_formRef$current3 = formRef.current) === null || _formRef$current3 === void 0 ? void 0 : _formRef$current3.getFieldValue(rowKeyName);\n    };\n\n    return _objectSpread(_objectSpread({}, formRef.current), {}, {\n      getRowData: getRowData,\n      getRowsData: getRowsData,\n\n      /**\n       * 设置一行的数据，会将数据进行简单的 merge\n       * @param rowIndex\n       * @param data\n       * @returns void\n       */\n      setRowData: function setRowData(rowIndex, data) {\n        var _finlayRowKey$toStrin2, _formRef$current4, _formRef$current4$get, _formRef$current5;\n\n        if (rowIndex == undefined) {\n          throw new Error('rowIndex is required');\n        }\n\n        var finlayRowKey = coverRowKey(rowIndex);\n        var rowKeyName = [props.name, (_finlayRowKey$toStrin2 = finlayRowKey === null || finlayRowKey === void 0 ? void 0 : finlayRowKey.toString()) !== null && _finlayRowKey$toStrin2 !== void 0 ? _finlayRowKey$toStrin2 : ''].flat(1).filter(Boolean);\n        var oldTableDate = ((_formRef$current4 = formRef.current) === null || _formRef$current4 === void 0 ? void 0 : (_formRef$current4$get = _formRef$current4.getFieldsValue) === null || _formRef$current4$get === void 0 ? void 0 : _formRef$current4$get.call(_formRef$current4)) || {};\n        var updateValues = set(oldTableDate, rowKeyName, _objectSpread(_objectSpread({}, getRowData(rowIndex)), data || {}));\n        return (_formRef$current5 = formRef.current) === null || _formRef$current5 === void 0 ? void 0 : _formRef$current5.setFieldsValue(updateValues);\n      }\n    });\n  });\n  useEffect(function () {\n    if (!props.controlled) return;\n    value.forEach(function (current, index) {\n      var _formRef$current6;\n\n      (_formRef$current6 = formRef.current) === null || _formRef$current6 === void 0 ? void 0 : _formRef$current6.setFieldsValue(_defineProperty({}, getRowKey(current, index), current));\n    }, {}); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [value, props.controlled]);\n  useEffect(function () {\n    if (props.name) {\n      var _props$editable;\n\n      formRef.current = props === null || props === void 0 ? void 0 : (_props$editable = props.editable) === null || _props$editable === void 0 ? void 0 : _props$editable.form;\n    }\n  }, [(_props$editable2 = props.editable) === null || _props$editable2 === void 0 ? void 0 : _props$editable2.form, props.name]);\n\n  var _ref = recordCreatorProps || {},\n      record = _ref.record,\n      position = _ref.position,\n      creatorButtonText = _ref.creatorButtonText,\n      newRecordType = _ref.newRecordType,\n      parentKey = _ref.parentKey,\n      style = _ref.style,\n      restButtonProps = _objectWithoutProperties(_ref, _excluded2);\n\n  var isTop = position === 'top';\n  var creatorButtonDom = useMemo(function () {\n    if (maxLength && maxLength <= (value === null || value === void 0 ? void 0 : value.length)) {\n      return false;\n    }\n\n    return recordCreatorProps !== false && /*#__PURE__*/React.createElement(RecordCreator, {\n      record: runFunction(record, value === null || value === void 0 ? void 0 : value.length, value) || {},\n      position: position,\n      parentKey: runFunction(parentKey, value === null || value === void 0 ? void 0 : value.length, value),\n      newRecordType: newRecordType\n    }, /*#__PURE__*/React.createElement(_Button, _extends({\n      type: \"dashed\",\n      style: _objectSpread({\n        display: 'block',\n        margin: '10px 0',\n        width: '100%'\n      }, style),\n      icon: /*#__PURE__*/React.createElement(PlusOutlined, null)\n    }, restButtonProps), creatorButtonText || '添加一行数据')); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [recordCreatorProps, maxLength, value === null || value === void 0 ? void 0 : value.length]);\n  var buttonRenderProps = useMemo(function () {\n    if (!creatorButtonDom) {\n      return {};\n    }\n\n    if (isTop) {\n      return {\n        components: {\n          header: {\n            wrapper: function wrapper(_ref2) {\n              var _rest$columns;\n\n              var className = _ref2.className,\n                  children = _ref2.children;\n              return /*#__PURE__*/React.createElement(\"thead\", {\n                className: className\n              }, children, /*#__PURE__*/React.createElement(\"tr\", {\n                style: {\n                  position: 'relative'\n                }\n              }, /*#__PURE__*/React.createElement(\"td\", {\n                colSpan: 0,\n                style: {\n                  visibility: 'hidden'\n                }\n              }, creatorButtonDom), /*#__PURE__*/React.createElement(\"td\", {\n                style: {\n                  position: 'absolute',\n                  left: 0,\n                  width: '100%'\n                },\n                colSpan: (_rest$columns = rest.columns) === null || _rest$columns === void 0 ? void 0 : _rest$columns.length\n              }, creatorButtonDom)));\n            }\n          }\n        }\n      };\n    }\n\n    return {\n      tableViewRender: function tableViewRender(_, dom) {\n        var _props$tableViewRende, _props$tableViewRende2;\n\n        return /*#__PURE__*/React.createElement(React.Fragment, null, (_props$tableViewRende = (_props$tableViewRende2 = props.tableViewRender) === null || _props$tableViewRende2 === void 0 ? void 0 : _props$tableViewRende2.call(props, _, dom)) !== null && _props$tableViewRende !== void 0 ? _props$tableViewRende : dom, creatorButtonDom);\n      }\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isTop, creatorButtonDom]);\n\n  var editableProps = _objectSpread({}, props.editable);\n  /**\n   * 防止闭包的onchange\n   *\n   * >>>>>>为了性能好辛苦\n   */\n\n\n  var newOnValueChange = useRefFunction(function (r, dataSource) {\n    var _props$editable3, _props$editable3$onVa, _props$onValuesChange;\n\n    (_props$editable3 = props.editable) === null || _props$editable3 === void 0 ? void 0 : (_props$editable3$onVa = _props$editable3.onValuesChange) === null || _props$editable3$onVa === void 0 ? void 0 : _props$editable3$onVa.call(_props$editable3, r, dataSource);\n    (_props$onValuesChange = props.onValuesChange) === null || _props$onValuesChange === void 0 ? void 0 : _props$onValuesChange.call(props, dataSource, r);\n\n    if (props.controlled) {\n      var _props$onChange;\n\n      props === null || props === void 0 ? void 0 : (_props$onChange = props.onChange) === null || _props$onChange === void 0 ? void 0 : _props$onChange.call(props, dataSource);\n    }\n  });\n\n  if ((props === null || props === void 0 ? void 0 : props.onValuesChange) || ((_props$editable4 = props.editable) === null || _props$editable4 === void 0 ? void 0 : _props$editable4.onValuesChange) || // 受控模式需要触发 onchange\n  props.controlled && (props === null || props === void 0 ? void 0 : props.onChange)) {\n    editableProps.onValuesChange = newOnValueChange;\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(EditableTableActionContext.Provider, {\n    value: actionRef\n  }, /*#__PURE__*/React.createElement(ProTable, _extends({\n    search: false,\n    options: false,\n    pagination: false,\n    rowKey: rowKey,\n    revalidateOnFocus: false\n  }, rest, buttonRenderProps, {\n    tableLayout: \"fixed\",\n    actionRef: actionRef,\n    onChange: onTableChange,\n    editable: _objectSpread(_objectSpread({}, editableProps), {}, {\n      formProps: _objectSpread({\n        formRef: formRef\n      }, editableProps.formProps)\n    }),\n    dataSource: value,\n    onDataSourceChange: function onDataSourceChange(dataSource) {\n      setValue(dataSource);\n      /**\n       * 如果是top，需要重新设置一下 form，不然会导致 id 相同数据混淆\n       */\n\n      if (props.name && position === 'top') {\n        var _formRef$current7;\n\n        var newValue = set({}, [props.name].flat(1).filter(Boolean), dataSource);\n        (_formRef$current7 = formRef.current) === null || _formRef$current7 === void 0 ? void 0 : _formRef$current7.setFieldsValue(newValue);\n      }\n    }\n  }))), props.name ? /*#__PURE__*/React.createElement(ProFormDependency, {\n    name: [props.name]\n  }, function (changeValue) {\n    var _props$editable5, _props$editable5$onVa;\n\n    var list = get(changeValue, [props.name].flat(1));\n    var changeItem = list === null || list === void 0 ? void 0 : list.find(function (item, index) {\n      return !isDeepEqualReact(item, preData === null || preData === void 0 ? void 0 : preData[index]);\n    });\n    if (!changeItem) return null;\n    props === null || props === void 0 ? void 0 : (_props$editable5 = props.editable) === null || _props$editable5 === void 0 ? void 0 : (_props$editable5$onVa = _props$editable5.onValuesChange) === null || _props$editable5$onVa === void 0 ? void 0 : _props$editable5$onVa.call(_props$editable5, changeItem, list);\n    return null;\n  }) : null);\n}\n\nfunction FieldEditableTable(props) {\n  if (!props.name) return /*#__PURE__*/React.createElement(EditableTable, props);\n  return /*#__PURE__*/React.createElement(_Form.Item, _extends({\n    style: {\n      maxWidth: '100%'\n    }\n  }, props === null || props === void 0 ? void 0 : props.formItemProps, {\n    name: props.name\n  }), /*#__PURE__*/React.createElement(Field, {\n    shouldUpdate: true,\n    name: props.name,\n    isList: true\n  }, function (control, _, form) {\n    return /*#__PURE__*/React.createElement(EditableTable, _extends({}, props, {\n      editable: _objectSpread(_objectSpread({}, props.editable), {}, {\n        form: form\n      }),\n      value: control.value || [],\n      onChange: control.onChange\n    }));\n  }));\n}\n\nFieldEditableTable.RecordCreator = RecordCreator;\nexport default FieldEditableTable;","map":{"version":3,"sources":["/Users/jameszow/Documents/RustWorkSpace/covid-ipfs/covid-ipfs-client/node_modules/@ant-design/pro-table/es/components/EditableTable/index.js"],"names":["_Form","_Button","_extends","_defineProperty","_slicedToArray","_objectWithoutProperties","_regeneratorRuntime","_asyncToGenerator","_objectSpread","_excluded","_excluded2","PlusOutlined","ProFormDependency","isDeepEqualReact","runFunction","usePrevious","useRefFunction","Field","useMergedState","get","set","React","useContext","useEffect","useImperativeHandle","useMemo","useRef","ProTable","EditableTableActionContext","createContext","undefined","RecordCreator","props","children","record","position","newRecordType","parentKey","actionRef","cloneElement","onClick","_onClick","mark","_callee","e","_children$props$onCli","_children$props","_actionRef$current","isOk","wrap","_callee$","_context","prev","next","call","sent","abrupt","current","addEditRecord","stop","_x","apply","arguments","EditableTable","_props$editable2","_props$editable4","onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef","rest","preData","value","formRef","_useMergedState","_useMergedState2","setValue","getRowKey","index","coverRowKey","finlayRowKey","name","length","rowData","at","rowIndex","findIndex","item","_getRowKey","toString","getRowData","_finlayRowKey$toStrin","_formRef$current","Error","rowKeyName","flat","filter","Boolean","getFieldValue","getRowsData","_formRef$current3","Array","isArray","_formRef$current2","getFieldsValue","Object","keys","map","key","setRowData","data","_finlayRowKey$toStrin2","_formRef$current4","_formRef$current4$get","_formRef$current5","oldTableDate","updateValues","setFieldsValue","forEach","_formRef$current6","_props$editable","editable","form","_ref","creatorButtonText","style","restButtonProps","isTop","creatorButtonDom","createElement","type","display","margin","width","icon","buttonRenderProps","components","header","wrapper","_ref2","_rest$columns","className","colSpan","visibility","left","columns","tableViewRender","_","dom","_props$tableViewRende","_props$tableViewRende2","Fragment","editableProps","newOnValueChange","r","dataSource","_props$editable3","_props$editable3$onVa","_props$onValuesChange","onValuesChange","_props$onChange","Provider","search","options","pagination","revalidateOnFocus","tableLayout","formProps","onDataSourceChange","_formRef$current7","newValue","changeValue","_props$editable5","_props$editable5$onVa","list","changeItem","find","FieldEditableTable","Item","maxWidth","shouldUpdate","isList","control"],"mappings":"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","sourcesContent":["import \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _regeneratorRuntime from \"@babel/runtime/helpers/esm/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nvar _excluded = [\"onTableChange\", \"maxLength\", \"formItemProps\", \"recordCreatorProps\", \"rowKey\", \"controlled\", \"defaultValue\", \"onChange\", \"editableFormRef\"],\n    _excluded2 = [\"record\", \"position\", \"creatorButtonText\", \"newRecordType\", \"parentKey\", \"style\"];\nimport { PlusOutlined } from '@ant-design/icons';\nimport { ProFormDependency } from '@ant-design/pro-form';\nimport { isDeepEqualReact, runFunction, usePrevious, useRefFunction } from '@ant-design/pro-utils';\nimport { Field } from 'rc-field-form';\nimport useMergedState from \"rc-util/es/hooks/useMergedState\";\nimport get from \"rc-util/es/utils/get\";\nimport set from \"rc-util/es/utils/set\";\nimport React, { useContext, useEffect, useImperativeHandle, useMemo, useRef } from 'react';\nimport ProTable from '../../Table';\nvar EditableTableActionContext = /*#__PURE__*/React.createContext(undefined);\n/** 可编辑表格的按钮 */\n\nfunction RecordCreator(props) {\n  var children = props.children,\n      record = props.record,\n      position = props.position,\n      newRecordType = props.newRecordType,\n      parentKey = props.parentKey;\n  var actionRef = useContext(EditableTableActionContext);\n  return /*#__PURE__*/React.cloneElement(children, _objectSpread(_objectSpread({}, children.props), {}, {\n    onClick: function () {\n      var _onClick = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(e) {\n        var _children$props$onCli, _children$props, _actionRef$current;\n\n        var isOk;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return (_children$props$onCli = (_children$props = children.props).onClick) === null || _children$props$onCli === void 0 ? void 0 : _children$props$onCli.call(_children$props, e);\n\n              case 2:\n                isOk = _context.sent;\n\n                if (!(isOk === false)) {\n                  _context.next = 5;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 5:\n                actionRef === null || actionRef === void 0 ? void 0 : (_actionRef$current = actionRef.current) === null || _actionRef$current === void 0 ? void 0 : _actionRef$current.addEditRecord(record, {\n                  position: position,\n                  newRecordType: newRecordType,\n                  parentKey: parentKey\n                });\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function onClick(_x) {\n        return _onClick.apply(this, arguments);\n      }\n\n      return onClick;\n    }()\n  }));\n}\n/**\n * 可以直接放到 Form 中的可编辑表格\n *\n * @param props\n */\n\n\nfunction EditableTable(props) {\n  var _props$editable2, _props$editable4;\n\n  var onTableChange = props.onTableChange,\n      maxLength = props.maxLength,\n      formItemProps = props.formItemProps,\n      recordCreatorProps = props.recordCreatorProps,\n      rowKey = props.rowKey,\n      controlled = props.controlled,\n      defaultValue = props.defaultValue,\n      onChange = props.onChange,\n      editableFormRef = props.editableFormRef,\n      rest = _objectWithoutProperties(props, _excluded);\n\n  var preData = usePrevious(props.value);\n  var actionRef = useRef();\n  var formRef = useRef(); // 设置 ref\n\n  useImperativeHandle(rest.actionRef, function () {\n    return actionRef.current;\n  });\n\n  var _useMergedState = useMergedState(function () {\n    return props.value || defaultValue || [];\n  }, {\n    value: props.value,\n    onChange: props.onChange\n  }),\n      _useMergedState2 = _slicedToArray(_useMergedState, 2),\n      value = _useMergedState2[0],\n      setValue = _useMergedState2[1];\n\n  var getRowKey = React.useMemo(function () {\n    if (typeof rowKey === 'function') {\n      return rowKey;\n    }\n\n    return function (record, index) {\n      return record[rowKey] || index;\n    };\n  }, [rowKey]);\n  /**\n   * 根据不同的情况返回不同的 rowKey\n   * @param finlayRowKey\n   * @returns string | number\n   */\n\n  var coverRowKey = function coverRowKey(finlayRowKey) {\n    /**\n     * 如果是 prop.name 的模式，就需要把行号转化成具体的rowKey。\n     */\n    if (typeof finlayRowKey === 'number' && !props.name) {\n      if (finlayRowKey >= value.length) return finlayRowKey;\n      var rowData = value === null || value === void 0 ? void 0 : value.at(finlayRowKey);\n      return getRowKey === null || getRowKey === void 0 ? void 0 : getRowKey(rowData, finlayRowKey);\n    }\n    /**\n     * 如果是 prop.name 的模式，就直接返回行号\n     */\n\n\n    if ((typeof finlayRowKey === 'string' || finlayRowKey >= value.length) && props.name) {\n      var rowIndex = value.findIndex(function (item, index) {\n        var _getRowKey;\n\n        return (getRowKey === null || getRowKey === void 0 ? void 0 : (_getRowKey = getRowKey(item, index)) === null || _getRowKey === void 0 ? void 0 : _getRowKey.toString()) === (finlayRowKey === null || finlayRowKey === void 0 ? void 0 : finlayRowKey.toString());\n      });\n      return rowIndex;\n    }\n\n    return finlayRowKey;\n  }; // 设置 editableFormRef\n\n\n  useImperativeHandle(editableFormRef, function () {\n    /**\n     * 获取一行数据的\n     * @param rowIndex\n     * @returns T | undefined\n     */\n    var getRowData = function getRowData(rowIndex) {\n      var _finlayRowKey$toStrin, _formRef$current;\n\n      if (rowIndex == undefined) {\n        throw new Error('rowIndex is required');\n      }\n\n      var finlayRowKey = coverRowKey(rowIndex);\n      var rowKeyName = [props.name, (_finlayRowKey$toStrin = finlayRowKey === null || finlayRowKey === void 0 ? void 0 : finlayRowKey.toString()) !== null && _finlayRowKey$toStrin !== void 0 ? _finlayRowKey$toStrin : ''].flat(1).filter(Boolean);\n      return (_formRef$current = formRef.current) === null || _formRef$current === void 0 ? void 0 : _formRef$current.getFieldValue(rowKeyName);\n    };\n    /**\n     * 获取整个 table 的数据\n     * @returns T[] | undefined\n     */\n\n\n    var getRowsData = function getRowsData() {\n      var _formRef$current3;\n\n      var rowKeyName = [props.name].flat(1).filter(Boolean);\n\n      if (Array.isArray(rowKeyName) && rowKeyName.length === 0) {\n        var _formRef$current2;\n\n        var rowData = (_formRef$current2 = formRef.current) === null || _formRef$current2 === void 0 ? void 0 : _formRef$current2.getFieldsValue();\n        if (Array.isArray(rowData)) return rowData;\n        return Object.keys(rowData).map(function (key) {\n          return rowData[key];\n        });\n      }\n\n      return (_formRef$current3 = formRef.current) === null || _formRef$current3 === void 0 ? void 0 : _formRef$current3.getFieldValue(rowKeyName);\n    };\n\n    return _objectSpread(_objectSpread({}, formRef.current), {}, {\n      getRowData: getRowData,\n      getRowsData: getRowsData,\n\n      /**\n       * 设置一行的数据，会将数据进行简单的 merge\n       * @param rowIndex\n       * @param data\n       * @returns void\n       */\n      setRowData: function setRowData(rowIndex, data) {\n        var _finlayRowKey$toStrin2, _formRef$current4, _formRef$current4$get, _formRef$current5;\n\n        if (rowIndex == undefined) {\n          throw new Error('rowIndex is required');\n        }\n\n        var finlayRowKey = coverRowKey(rowIndex);\n        var rowKeyName = [props.name, (_finlayRowKey$toStrin2 = finlayRowKey === null || finlayRowKey === void 0 ? void 0 : finlayRowKey.toString()) !== null && _finlayRowKey$toStrin2 !== void 0 ? _finlayRowKey$toStrin2 : ''].flat(1).filter(Boolean);\n        var oldTableDate = ((_formRef$current4 = formRef.current) === null || _formRef$current4 === void 0 ? void 0 : (_formRef$current4$get = _formRef$current4.getFieldsValue) === null || _formRef$current4$get === void 0 ? void 0 : _formRef$current4$get.call(_formRef$current4)) || {};\n        var updateValues = set(oldTableDate, rowKeyName, _objectSpread(_objectSpread({}, getRowData(rowIndex)), data || {}));\n        return (_formRef$current5 = formRef.current) === null || _formRef$current5 === void 0 ? void 0 : _formRef$current5.setFieldsValue(updateValues);\n      }\n    });\n  });\n  useEffect(function () {\n    if (!props.controlled) return;\n    value.forEach(function (current, index) {\n      var _formRef$current6;\n\n      (_formRef$current6 = formRef.current) === null || _formRef$current6 === void 0 ? void 0 : _formRef$current6.setFieldsValue(_defineProperty({}, getRowKey(current, index), current));\n    }, {}); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [value, props.controlled]);\n  useEffect(function () {\n    if (props.name) {\n      var _props$editable;\n\n      formRef.current = props === null || props === void 0 ? void 0 : (_props$editable = props.editable) === null || _props$editable === void 0 ? void 0 : _props$editable.form;\n    }\n  }, [(_props$editable2 = props.editable) === null || _props$editable2 === void 0 ? void 0 : _props$editable2.form, props.name]);\n\n  var _ref = recordCreatorProps || {},\n      record = _ref.record,\n      position = _ref.position,\n      creatorButtonText = _ref.creatorButtonText,\n      newRecordType = _ref.newRecordType,\n      parentKey = _ref.parentKey,\n      style = _ref.style,\n      restButtonProps = _objectWithoutProperties(_ref, _excluded2);\n\n  var isTop = position === 'top';\n  var creatorButtonDom = useMemo(function () {\n    if (maxLength && maxLength <= (value === null || value === void 0 ? void 0 : value.length)) {\n      return false;\n    }\n\n    return recordCreatorProps !== false && /*#__PURE__*/React.createElement(RecordCreator, {\n      record: runFunction(record, value === null || value === void 0 ? void 0 : value.length, value) || {},\n      position: position,\n      parentKey: runFunction(parentKey, value === null || value === void 0 ? void 0 : value.length, value),\n      newRecordType: newRecordType\n    }, /*#__PURE__*/React.createElement(_Button, _extends({\n      type: \"dashed\",\n      style: _objectSpread({\n        display: 'block',\n        margin: '10px 0',\n        width: '100%'\n      }, style),\n      icon: /*#__PURE__*/React.createElement(PlusOutlined, null)\n    }, restButtonProps), creatorButtonText || '添加一行数据')); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [recordCreatorProps, maxLength, value === null || value === void 0 ? void 0 : value.length]);\n  var buttonRenderProps = useMemo(function () {\n    if (!creatorButtonDom) {\n      return {};\n    }\n\n    if (isTop) {\n      return {\n        components: {\n          header: {\n            wrapper: function wrapper(_ref2) {\n              var _rest$columns;\n\n              var className = _ref2.className,\n                  children = _ref2.children;\n              return /*#__PURE__*/React.createElement(\"thead\", {\n                className: className\n              }, children, /*#__PURE__*/React.createElement(\"tr\", {\n                style: {\n                  position: 'relative'\n                }\n              }, /*#__PURE__*/React.createElement(\"td\", {\n                colSpan: 0,\n                style: {\n                  visibility: 'hidden'\n                }\n              }, creatorButtonDom), /*#__PURE__*/React.createElement(\"td\", {\n                style: {\n                  position: 'absolute',\n                  left: 0,\n                  width: '100%'\n                },\n                colSpan: (_rest$columns = rest.columns) === null || _rest$columns === void 0 ? void 0 : _rest$columns.length\n              }, creatorButtonDom)));\n            }\n          }\n        }\n      };\n    }\n\n    return {\n      tableViewRender: function tableViewRender(_, dom) {\n        var _props$tableViewRende, _props$tableViewRende2;\n\n        return /*#__PURE__*/React.createElement(React.Fragment, null, (_props$tableViewRende = (_props$tableViewRende2 = props.tableViewRender) === null || _props$tableViewRende2 === void 0 ? void 0 : _props$tableViewRende2.call(props, _, dom)) !== null && _props$tableViewRende !== void 0 ? _props$tableViewRende : dom, creatorButtonDom);\n      }\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isTop, creatorButtonDom]);\n\n  var editableProps = _objectSpread({}, props.editable);\n  /**\n   * 防止闭包的onchange\n   *\n   * >>>>>>为了性能好辛苦\n   */\n\n\n  var newOnValueChange = useRefFunction(function (r, dataSource) {\n    var _props$editable3, _props$editable3$onVa, _props$onValuesChange;\n\n    (_props$editable3 = props.editable) === null || _props$editable3 === void 0 ? void 0 : (_props$editable3$onVa = _props$editable3.onValuesChange) === null || _props$editable3$onVa === void 0 ? void 0 : _props$editable3$onVa.call(_props$editable3, r, dataSource);\n    (_props$onValuesChange = props.onValuesChange) === null || _props$onValuesChange === void 0 ? void 0 : _props$onValuesChange.call(props, dataSource, r);\n\n    if (props.controlled) {\n      var _props$onChange;\n\n      props === null || props === void 0 ? void 0 : (_props$onChange = props.onChange) === null || _props$onChange === void 0 ? void 0 : _props$onChange.call(props, dataSource);\n    }\n  });\n\n  if ((props === null || props === void 0 ? void 0 : props.onValuesChange) || ((_props$editable4 = props.editable) === null || _props$editable4 === void 0 ? void 0 : _props$editable4.onValuesChange) || // 受控模式需要触发 onchange\n  props.controlled && (props === null || props === void 0 ? void 0 : props.onChange)) {\n    editableProps.onValuesChange = newOnValueChange;\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(EditableTableActionContext.Provider, {\n    value: actionRef\n  }, /*#__PURE__*/React.createElement(ProTable, _extends({\n    search: false,\n    options: false,\n    pagination: false,\n    rowKey: rowKey,\n    revalidateOnFocus: false\n  }, rest, buttonRenderProps, {\n    tableLayout: \"fixed\",\n    actionRef: actionRef,\n    onChange: onTableChange,\n    editable: _objectSpread(_objectSpread({}, editableProps), {}, {\n      formProps: _objectSpread({\n        formRef: formRef\n      }, editableProps.formProps)\n    }),\n    dataSource: value,\n    onDataSourceChange: function onDataSourceChange(dataSource) {\n      setValue(dataSource);\n      /**\n       * 如果是top，需要重新设置一下 form，不然会导致 id 相同数据混淆\n       */\n\n      if (props.name && position === 'top') {\n        var _formRef$current7;\n\n        var newValue = set({}, [props.name].flat(1).filter(Boolean), dataSource);\n        (_formRef$current7 = formRef.current) === null || _formRef$current7 === void 0 ? void 0 : _formRef$current7.setFieldsValue(newValue);\n      }\n    }\n  }))), props.name ? /*#__PURE__*/React.createElement(ProFormDependency, {\n    name: [props.name]\n  }, function (changeValue) {\n    var _props$editable5, _props$editable5$onVa;\n\n    var list = get(changeValue, [props.name].flat(1));\n    var changeItem = list === null || list === void 0 ? void 0 : list.find(function (item, index) {\n      return !isDeepEqualReact(item, preData === null || preData === void 0 ? void 0 : preData[index]);\n    });\n    if (!changeItem) return null;\n    props === null || props === void 0 ? void 0 : (_props$editable5 = props.editable) === null || _props$editable5 === void 0 ? void 0 : (_props$editable5$onVa = _props$editable5.onValuesChange) === null || _props$editable5$onVa === void 0 ? void 0 : _props$editable5$onVa.call(_props$editable5, changeItem, list);\n    return null;\n  }) : null);\n}\n\nfunction FieldEditableTable(props) {\n  if (!props.name) return /*#__PURE__*/React.createElement(EditableTable, props);\n  return /*#__PURE__*/React.createElement(_Form.Item, _extends({\n    style: {\n      maxWidth: '100%'\n    }\n  }, props === null || props === void 0 ? void 0 : props.formItemProps, {\n    name: props.name\n  }), /*#__PURE__*/React.createElement(Field, {\n    shouldUpdate: true,\n    name: props.name,\n    isList: true\n  }, function (control, _, form) {\n    return /*#__PURE__*/React.createElement(EditableTable, _extends({}, props, {\n      editable: _objectSpread(_objectSpread({}, props.editable), {}, {\n        form: form\n      }),\n      value: control.value || [],\n      onChange: control.onChange\n    }));\n  }));\n}\n\nFieldEditableTable.RecordCreator = RecordCreator;\nexport default FieldEditableTable;"]},"metadata":{},"sourceType":"module"}