{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport useMergedState from \"rc-util/es/hooks/useMergedState\";\nimport { noteOnce } from \"rc-util/es/warning\";\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { createContainer } from 'unstated-next';\nimport { genColumnKey } from './utils';\n\nfunction useContainer() {\n  var _props$columnsState3, _props$columnsState4, _props$columnsState8, _props$columnsState9;\n\n  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var actionRef = useRef();\n  var rootDomRef = useRef(null);\n  /** 父 form item 的 name */\n\n  var prefixNameRef = useRef();\n  /** 自己 props 的引用 */\n\n  var propsRef = useRef();\n  /** 可编辑表格的formRef */\n\n  var editableFormRef = useRef(); // 共享状态比较难，就放到这里了\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      keyWords = _useState2[0],\n      _setKeyWords = _useState2[1]; // 用于排序的数组\n\n\n  var sortKeyColumns = useRef([]);\n\n  var _useMergedState = useMergedState(function () {\n    return props.size || props.defaultSize || 'middle';\n  }, {\n    value: props.size,\n    onChange: props.onSizeChange\n  }),\n      _useMergedState2 = _slicedToArray(_useMergedState, 2),\n      tableSize = _useMergedState2[0],\n      setTableSize = _useMergedState2[1];\n  /** 默认全选中 */\n\n\n  var defaultColumnKeyMap = useMemo(function () {\n    var _props$columns;\n\n    var columnKeyMap = {};\n    (_props$columns = props.columns) === null || _props$columns === void 0 ? void 0 : _props$columns.forEach(function (_ref, index) {\n      var key = _ref.key,\n          dataIndex = _ref.dataIndex,\n          fixed = _ref.fixed,\n          disable = _ref.disable;\n      var columnKey = genColumnKey(key !== null && key !== void 0 ? key : dataIndex, index);\n\n      if (columnKey) {\n        columnKeyMap[columnKey] = {\n          show: true,\n          fixed: fixed,\n          disable: disable\n        };\n      }\n    });\n    return columnKeyMap;\n  }, [props.columns]);\n\n  var _useMergedState3 = useMergedState(function () {\n    var _props$columnsState, _props$columnsState2;\n\n    var _ref2 = props.columnsState || {},\n        persistenceType = _ref2.persistenceType,\n        persistenceKey = _ref2.persistenceKey;\n\n    if (persistenceKey && persistenceType && typeof window !== 'undefined') {\n      /** 从持久化中读取数据 */\n      var storage = window[persistenceType];\n\n      try {\n        var storageValue = storage === null || storage === void 0 ? void 0 : storage.getItem(persistenceKey);\n\n        if (storageValue) {\n          return JSON.parse(storageValue);\n        }\n      } catch (error) {\n        console.warn(error);\n      }\n    }\n\n    return props.columnsStateMap || ((_props$columnsState = props.columnsState) === null || _props$columnsState === void 0 ? void 0 : _props$columnsState.value) || ((_props$columnsState2 = props.columnsState) === null || _props$columnsState2 === void 0 ? void 0 : _props$columnsState2.defaultValue) || defaultColumnKeyMap;\n  }, {\n    value: ((_props$columnsState3 = props.columnsState) === null || _props$columnsState3 === void 0 ? void 0 : _props$columnsState3.value) || props.columnsStateMap,\n    onChange: ((_props$columnsState4 = props.columnsState) === null || _props$columnsState4 === void 0 ? void 0 : _props$columnsState4.onChange) || props.onColumnsStateChange\n  }),\n      _useMergedState4 = _slicedToArray(_useMergedState3, 2),\n      columnsMap = _useMergedState4[0],\n      setColumnsMap = _useMergedState4[1];\n\n  noteOnce(!props.columnsStateMap, 'columnsStateMap已经废弃，请使用 columnsState.value 替换');\n  noteOnce(!props.columnsStateMap, 'columnsStateMap has been discarded, please use columnSstate.value replacement');\n  /** 清空一下当前的 key */\n\n  var clearPersistenceStorage = useCallback(function () {\n    var _ref3 = props.columnsState || {},\n        persistenceType = _ref3.persistenceType,\n        persistenceKey = _ref3.persistenceKey;\n\n    if (!persistenceKey || !persistenceType || typeof window === 'undefined') return;\n    /** 给持久化中设置数据 */\n\n    var storage = window[persistenceType];\n\n    try {\n      storage === null || storage === void 0 ? void 0 : storage.removeItem(persistenceKey);\n    } catch (error) {\n      console.error(error);\n    }\n  }, [props.columnsState]);\n  useEffect(function () {\n    var _props$columnsState5, _props$columnsState6;\n\n    if (!((_props$columnsState5 = props.columnsState) === null || _props$columnsState5 === void 0 ? void 0 : _props$columnsState5.persistenceKey) || !((_props$columnsState6 = props.columnsState) === null || _props$columnsState6 === void 0 ? void 0 : _props$columnsState6.persistenceType)) {\n      return;\n    }\n\n    if (typeof window === 'undefined') return;\n    /** 给持久化中设置数据 */\n\n    var _props$columnsState7 = props.columnsState,\n        persistenceType = _props$columnsState7.persistenceType,\n        persistenceKey = _props$columnsState7.persistenceKey;\n    var storage = window[persistenceType];\n\n    try {\n      storage === null || storage === void 0 ? void 0 : storage.setItem(persistenceKey, JSON.stringify(columnsMap));\n    } catch (error) {\n      console.error(error);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [(_props$columnsState8 = props.columnsState) === null || _props$columnsState8 === void 0 ? void 0 : _props$columnsState8.persistenceKey, columnsMap, (_props$columnsState9 = props.columnsState) === null || _props$columnsState9 === void 0 ? void 0 : _props$columnsState9.persistenceType]);\n  var renderValue = {\n    action: actionRef.current,\n    setAction: function setAction(newAction) {\n      actionRef.current = newAction;\n    },\n    sortKeyColumns: sortKeyColumns.current,\n    setSortKeyColumns: function setSortKeyColumns(keys) {\n      sortKeyColumns.current = keys;\n    },\n    propsRef: propsRef,\n    columnsMap: columnsMap,\n    keyWords: keyWords,\n    setKeyWords: function setKeyWords(k) {\n      return _setKeyWords(k);\n    },\n    setTableSize: setTableSize,\n    tableSize: tableSize,\n    prefixName: prefixNameRef.current,\n    setPrefixName: function setPrefixName(name) {\n      prefixNameRef.current = name;\n    },\n    setEditorTableForm: function setEditorTableForm(form) {\n      editableFormRef.current = form;\n    },\n    editableForm: editableFormRef.current,\n    setColumnsMap: setColumnsMap,\n    columns: props.columns,\n    rootDomRef: rootDomRef,\n    clearPersistenceStorage: clearPersistenceStorage\n  };\n  Object.defineProperty(renderValue, 'prefixName', {\n    get: function get() {\n      return prefixNameRef.current;\n    }\n  });\n  Object.defineProperty(renderValue, 'sortKeyColumns', {\n    get: function get() {\n      return sortKeyColumns.current;\n    }\n  });\n  Object.defineProperty(renderValue, 'action', {\n    get: function get() {\n      return actionRef.current;\n    }\n  });\n  Object.defineProperty(renderValue, 'editableForm', {\n    get: function get() {\n      return editableFormRef.current;\n    }\n  });\n  return renderValue;\n}\n\nvar Container = createContainer(useContainer);\nexport { useContainer };\nexport default Container;","map":{"version":3,"sources":["/Users/jameszow/Documents/RustWorkSpace/covid-ipfs/covid-ipfs-client/node_modules/@ant-design/pro-table/es/container.js"],"names":["_slicedToArray","useMergedState","noteOnce","useCallback","useEffect","useMemo","useRef","useState","createContainer","genColumnKey","useContainer","_props$columnsState3","_props$columnsState4","_props$columnsState8","_props$columnsState9","props","arguments","length","undefined","actionRef","rootDomRef","prefixNameRef","propsRef","editableFormRef","_useState","_useState2","keyWords","_setKeyWords","sortKeyColumns","_useMergedState","size","defaultSize","value","onChange","onSizeChange","_useMergedState2","tableSize","setTableSize","defaultColumnKeyMap","_props$columns","columnKeyMap","columns","forEach","_ref","index","key","dataIndex","fixed","disable","columnKey","show","_useMergedState3","_props$columnsState","_props$columnsState2","_ref2","columnsState","persistenceType","persistenceKey","window","storage","storageValue","getItem","JSON","parse","error","console","warn","columnsStateMap","defaultValue","onColumnsStateChange","_useMergedState4","columnsMap","setColumnsMap","clearPersistenceStorage","_ref3","removeItem","_props$columnsState5","_props$columnsState6","_props$columnsState7","setItem","stringify","renderValue","action","current","setAction","newAction","setSortKeyColumns","keys","setKeyWords","k","prefixName","setPrefixName","name","setEditorTableForm","form","editableForm","Object","defineProperty","get","Container"],"mappings":"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","sourcesContent":["import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport useMergedState from \"rc-util/es/hooks/useMergedState\";\nimport { noteOnce } from \"rc-util/es/warning\";\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { createContainer } from 'unstated-next';\nimport { genColumnKey } from './utils';\n\nfunction useContainer() {\n  var _props$columnsState3, _props$columnsState4, _props$columnsState8, _props$columnsState9;\n\n  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var actionRef = useRef();\n  var rootDomRef = useRef(null);\n  /** 父 form item 的 name */\n\n  var prefixNameRef = useRef();\n  /** 自己 props 的引用 */\n\n  var propsRef = useRef();\n  /** 可编辑表格的formRef */\n\n  var editableFormRef = useRef(); // 共享状态比较难，就放到这里了\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      keyWords = _useState2[0],\n      _setKeyWords = _useState2[1]; // 用于排序的数组\n\n\n  var sortKeyColumns = useRef([]);\n\n  var _useMergedState = useMergedState(function () {\n    return props.size || props.defaultSize || 'middle';\n  }, {\n    value: props.size,\n    onChange: props.onSizeChange\n  }),\n      _useMergedState2 = _slicedToArray(_useMergedState, 2),\n      tableSize = _useMergedState2[0],\n      setTableSize = _useMergedState2[1];\n  /** 默认全选中 */\n\n\n  var defaultColumnKeyMap = useMemo(function () {\n    var _props$columns;\n\n    var columnKeyMap = {};\n    (_props$columns = props.columns) === null || _props$columns === void 0 ? void 0 : _props$columns.forEach(function (_ref, index) {\n      var key = _ref.key,\n          dataIndex = _ref.dataIndex,\n          fixed = _ref.fixed,\n          disable = _ref.disable;\n      var columnKey = genColumnKey(key !== null && key !== void 0 ? key : dataIndex, index);\n\n      if (columnKey) {\n        columnKeyMap[columnKey] = {\n          show: true,\n          fixed: fixed,\n          disable: disable\n        };\n      }\n    });\n    return columnKeyMap;\n  }, [props.columns]);\n\n  var _useMergedState3 = useMergedState(function () {\n    var _props$columnsState, _props$columnsState2;\n\n    var _ref2 = props.columnsState || {},\n        persistenceType = _ref2.persistenceType,\n        persistenceKey = _ref2.persistenceKey;\n\n    if (persistenceKey && persistenceType && typeof window !== 'undefined') {\n      /** 从持久化中读取数据 */\n      var storage = window[persistenceType];\n\n      try {\n        var storageValue = storage === null || storage === void 0 ? void 0 : storage.getItem(persistenceKey);\n\n        if (storageValue) {\n          return JSON.parse(storageValue);\n        }\n      } catch (error) {\n        console.warn(error);\n      }\n    }\n\n    return props.columnsStateMap || ((_props$columnsState = props.columnsState) === null || _props$columnsState === void 0 ? void 0 : _props$columnsState.value) || ((_props$columnsState2 = props.columnsState) === null || _props$columnsState2 === void 0 ? void 0 : _props$columnsState2.defaultValue) || defaultColumnKeyMap;\n  }, {\n    value: ((_props$columnsState3 = props.columnsState) === null || _props$columnsState3 === void 0 ? void 0 : _props$columnsState3.value) || props.columnsStateMap,\n    onChange: ((_props$columnsState4 = props.columnsState) === null || _props$columnsState4 === void 0 ? void 0 : _props$columnsState4.onChange) || props.onColumnsStateChange\n  }),\n      _useMergedState4 = _slicedToArray(_useMergedState3, 2),\n      columnsMap = _useMergedState4[0],\n      setColumnsMap = _useMergedState4[1];\n\n  noteOnce(!props.columnsStateMap, 'columnsStateMap已经废弃，请使用 columnsState.value 替换');\n  noteOnce(!props.columnsStateMap, 'columnsStateMap has been discarded, please use columnSstate.value replacement');\n  /** 清空一下当前的 key */\n\n  var clearPersistenceStorage = useCallback(function () {\n    var _ref3 = props.columnsState || {},\n        persistenceType = _ref3.persistenceType,\n        persistenceKey = _ref3.persistenceKey;\n\n    if (!persistenceKey || !persistenceType || typeof window === 'undefined') return;\n    /** 给持久化中设置数据 */\n\n    var storage = window[persistenceType];\n\n    try {\n      storage === null || storage === void 0 ? void 0 : storage.removeItem(persistenceKey);\n    } catch (error) {\n      console.error(error);\n    }\n  }, [props.columnsState]);\n  useEffect(function () {\n    var _props$columnsState5, _props$columnsState6;\n\n    if (!((_props$columnsState5 = props.columnsState) === null || _props$columnsState5 === void 0 ? void 0 : _props$columnsState5.persistenceKey) || !((_props$columnsState6 = props.columnsState) === null || _props$columnsState6 === void 0 ? void 0 : _props$columnsState6.persistenceType)) {\n      return;\n    }\n\n    if (typeof window === 'undefined') return;\n    /** 给持久化中设置数据 */\n\n    var _props$columnsState7 = props.columnsState,\n        persistenceType = _props$columnsState7.persistenceType,\n        persistenceKey = _props$columnsState7.persistenceKey;\n    var storage = window[persistenceType];\n\n    try {\n      storage === null || storage === void 0 ? void 0 : storage.setItem(persistenceKey, JSON.stringify(columnsMap));\n    } catch (error) {\n      console.error(error);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [(_props$columnsState8 = props.columnsState) === null || _props$columnsState8 === void 0 ? void 0 : _props$columnsState8.persistenceKey, columnsMap, (_props$columnsState9 = props.columnsState) === null || _props$columnsState9 === void 0 ? void 0 : _props$columnsState9.persistenceType]);\n  var renderValue = {\n    action: actionRef.current,\n    setAction: function setAction(newAction) {\n      actionRef.current = newAction;\n    },\n    sortKeyColumns: sortKeyColumns.current,\n    setSortKeyColumns: function setSortKeyColumns(keys) {\n      sortKeyColumns.current = keys;\n    },\n    propsRef: propsRef,\n    columnsMap: columnsMap,\n    keyWords: keyWords,\n    setKeyWords: function setKeyWords(k) {\n      return _setKeyWords(k);\n    },\n    setTableSize: setTableSize,\n    tableSize: tableSize,\n    prefixName: prefixNameRef.current,\n    setPrefixName: function setPrefixName(name) {\n      prefixNameRef.current = name;\n    },\n    setEditorTableForm: function setEditorTableForm(form) {\n      editableFormRef.current = form;\n    },\n    editableForm: editableFormRef.current,\n    setColumnsMap: setColumnsMap,\n    columns: props.columns,\n    rootDomRef: rootDomRef,\n    clearPersistenceStorage: clearPersistenceStorage\n  };\n  Object.defineProperty(renderValue, 'prefixName', {\n    get: function get() {\n      return prefixNameRef.current;\n    }\n  });\n  Object.defineProperty(renderValue, 'sortKeyColumns', {\n    get: function get() {\n      return sortKeyColumns.current;\n    }\n  });\n  Object.defineProperty(renderValue, 'action', {\n    get: function get() {\n      return actionRef.current;\n    }\n  });\n  Object.defineProperty(renderValue, 'editableForm', {\n    get: function get() {\n      return editableFormRef.current;\n    }\n  });\n  return renderValue;\n}\n\nvar Container = createContainer(useContainer);\nexport { useContainer };\nexport default Container;"]},"metadata":{},"sourceType":"module"}