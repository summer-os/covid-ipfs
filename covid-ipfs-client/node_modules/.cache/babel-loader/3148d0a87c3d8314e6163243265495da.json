{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nvar _excluded = [\"children\"];\nimport { FieldContext, ProFormDependency, ProFormField } from '@ant-design/pro-form';\nimport { getFieldPropsOrFormItemProps, InlineErrorFormItem, runFunction } from '@ant-design/pro-utils';\nimport React, { useCallback, useContext, useEffect, useMemo, useState } from 'react';\nvar SHOW_EMPTY_TEXT_LIST = ['', null, undefined];\n/**\n * 拼接用于编辑的 key\n */\n\nexport var spellNamePath = function spellNamePath() {\n  for (var _len = arguments.length, rest = new Array(_len), _key = 0; _key < _len; _key++) {\n    rest[_key] = arguments[_key];\n  }\n\n  return rest.filter(function (index) {\n    return index !== undefined;\n  }).map(function (item) {\n    if (typeof item === 'number') {\n      return item.toString();\n    }\n\n    return item;\n  }).flat(1);\n};\n\nvar CellRenderFromItem = function CellRenderFromItem(props) {\n  var formContext = useContext(FieldContext);\n  var columnProps = props.columnProps,\n      prefixName = props.prefixName,\n      text = props.text,\n      counter = props.counter,\n      rowData = props.rowData,\n      index = props.index,\n      recordKey = props.recordKey,\n      subName = props.subName,\n      proFieldProps = props.proFieldProps;\n  var editableForm = counter.editableForm;\n  var key = recordKey || index;\n\n  var _useState = useState(function () {\n    var _ref, _columnProps$key;\n\n    return spellNamePath(prefixName, prefixName ? subName : [], prefixName ? index : key, (_ref = (_columnProps$key = columnProps === null || columnProps === void 0 ? void 0 : columnProps.key) !== null && _columnProps$key !== void 0 ? _columnProps$key : columnProps === null || columnProps === void 0 ? void 0 : columnProps.dataIndex) !== null && _ref !== void 0 ? _ref : index);\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      formItemName = _useState2[0],\n      setName = _useState2[1];\n\n  var rowName = useMemo(function () {\n    return formItemName.slice(0, -1);\n  }, [formItemName]);\n  useEffect(function () {\n    var _ref2, _columnProps$key2;\n\n    var value = spellNamePath(prefixName, prefixName ? subName : [], prefixName ? index : key, (_ref2 = (_columnProps$key2 = columnProps === null || columnProps === void 0 ? void 0 : columnProps.key) !== null && _columnProps$key2 !== void 0 ? _columnProps$key2 : columnProps === null || columnProps === void 0 ? void 0 : columnProps.dataIndex) !== null && _ref2 !== void 0 ? _ref2 : index);\n    if (value.join('-') !== formItemName.join('-')) setName(value);\n  }, [columnProps === null || columnProps === void 0 ? void 0 : columnProps.dataIndex, columnProps === null || columnProps === void 0 ? void 0 : columnProps.key, index, recordKey, prefixName, key, subName, formItemName]);\n  var needProps = useMemo(function () {\n    return [editableForm, _objectSpread(_objectSpread({}, columnProps), {}, {\n      rowKey: rowName,\n      rowIndex: index,\n      isEditable: true\n    })];\n  }, [columnProps, editableForm, index, rowName]);\n  var InlineItem = useCallback(function (_ref3) {\n    var children = _ref3.children,\n        restProps = _objectWithoutProperties(_ref3, _excluded);\n\n    return /*#__PURE__*/React.createElement(InlineErrorFormItem, _extends({\n      popoverProps: {\n        getPopupContainer: formContext.getPopupContainer || function () {\n          return counter.rootDomRef.current || document.body;\n        }\n      },\n      key: key,\n      errorType: \"popover\",\n      name: formItemName\n    }, restProps), children);\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [key, formItemName]);\n  var generateFormItem = useCallback(function () {\n    var _ref4, _ref5;\n\n    var formItemProps = _objectSpread({}, getFieldPropsOrFormItemProps.apply(void 0, [columnProps === null || columnProps === void 0 ? void 0 : columnProps.formItemProps].concat(_toConsumableArray(needProps))));\n\n    formItemProps.messageVariables = _objectSpread({\n      label: (columnProps === null || columnProps === void 0 ? void 0 : columnProps.title) || '此项',\n      type: (columnProps === null || columnProps === void 0 ? void 0 : columnProps.valueType) || '文本'\n    }, formItemProps === null || formItemProps === void 0 ? void 0 : formItemProps.messageVariables);\n    formItemProps.initialValue = (_ref4 = (_ref5 = prefixName ? null : text) !== null && _ref5 !== void 0 ? _ref5 : formItemProps === null || formItemProps === void 0 ? void 0 : formItemProps.initialValue) !== null && _ref4 !== void 0 ? _ref4 : columnProps === null || columnProps === void 0 ? void 0 : columnProps.initialValue;\n    var fieldDom = /*#__PURE__*/React.createElement(ProFormField, _extends({\n      cacheForSwr: true,\n      key: formItemName.join('-'),\n      name: formItemName,\n      proFormFieldKey: key,\n      ignoreFormItem: true,\n      fieldProps: getFieldPropsOrFormItemProps.apply(void 0, [columnProps === null || columnProps === void 0 ? void 0 : columnProps.fieldProps].concat(_toConsumableArray(needProps)))\n    }, proFieldProps));\n    /**\n     * 如果没有自定义直接返回\n     */\n\n    if (columnProps === null || columnProps === void 0 ? void 0 : columnProps.renderFormItem) {\n      fieldDom = columnProps.renderFormItem(_objectSpread(_objectSpread({}, columnProps), {}, {\n        index: index,\n        isEditable: true,\n        type: 'table'\n      }), {\n        defaultRender: function defaultRender() {\n          return /*#__PURE__*/React.createElement(InlineItem, formItemProps, fieldDom);\n        },\n        type: 'form',\n        recordKey: recordKey,\n        record: _objectSpread(_objectSpread({}, rowData), editableForm === null || editableForm === void 0 ? void 0 : editableForm.getFieldValue([key])),\n        isEditable: true\n      }, editableForm, props.editableUtils); // 如果需要完全自定义可以不要name\n\n      if (columnProps.ignoreFormItem) return /*#__PURE__*/React.createElement(React.Fragment, null, fieldDom);\n    }\n\n    return /*#__PURE__*/React.createElement(InlineItem, _extends({\n      key: formItemName.join('-')\n    }, formItemProps), fieldDom);\n  }, [columnProps, needProps, prefixName, text, key, formItemName, proFieldProps, InlineItem, index, recordKey, rowData, editableForm, props.editableUtils]);\n  if (formItemName.length === 0) return null;\n\n  if (typeof (columnProps === null || columnProps === void 0 ? void 0 : columnProps.renderFormItem) === 'function' || typeof (columnProps === null || columnProps === void 0 ? void 0 : columnProps.fieldProps) === 'function' || typeof (columnProps === null || columnProps === void 0 ? void 0 : columnProps.formItemProps) === 'function') {\n    return /*#__PURE__*/React.createElement(ProFormDependency, {\n      name: [rowName]\n    }, function () {\n      return generateFormItem();\n    });\n  }\n\n  return generateFormItem();\n};\n/**\n * 根据不同的类型来转化数值\n *\n * @param text\n * @param valueType\n */\n\n\nfunction cellRenderToFromItem(config) {\n  var _columnProps$dataInde;\n\n  var text = config.text,\n      valueType = config.valueType,\n      rowData = config.rowData,\n      columnProps = config.columnProps; // 如果 valueType === text ，没必要多走一次 render\n\n  if ((!valueType || ['textarea', 'text'].includes(valueType.toString())) && // valueEnum 存在说明是个select\n  !(columnProps === null || columnProps === void 0 ? void 0 : columnProps.valueEnum) && config.mode === 'read') {\n    // 如果是''、null、undefined 显示columnEmptyText\n    return SHOW_EMPTY_TEXT_LIST.includes(text) ? config.columnEmptyText : text;\n  }\n\n  if (typeof valueType === 'function' && rowData) {\n    // 防止valueType是函数,并且text是''、null、undefined跳过显式设置的columnEmptyText\n    return cellRenderToFromItem(_objectSpread(_objectSpread({}, config), {}, {\n      valueType: valueType(rowData, config.type) || 'text'\n    }));\n  }\n\n  var columnKey = (columnProps === null || columnProps === void 0 ? void 0 : columnProps.key) || (columnProps === null || columnProps === void 0 ? void 0 : (_columnProps$dataInde = columnProps.dataIndex) === null || _columnProps$dataInde === void 0 ? void 0 : _columnProps$dataInde.toString());\n  /**\n   * 生成公用的 proField dom 配置\n   */\n\n  var proFieldProps = {\n    valueEnum: runFunction(columnProps === null || columnProps === void 0 ? void 0 : columnProps.valueEnum, rowData),\n    request: columnProps === null || columnProps === void 0 ? void 0 : columnProps.request,\n    params: runFunction(columnProps === null || columnProps === void 0 ? void 0 : columnProps.params, rowData, columnProps),\n    readonly: columnProps === null || columnProps === void 0 ? void 0 : columnProps.readonly,\n    text: valueType === 'index' || valueType === 'indexBorder' ? config.index : text,\n    mode: config.mode,\n    renderFormItem: undefined,\n    valueType: valueType,\n    // @ts-ignore\n    record: rowData,\n    proFieldProps: {\n      emptyText: config.columnEmptyText,\n      proFieldKey: columnKey ? \"table-field-\".concat(columnKey) : undefined\n    }\n  };\n  /** 只读模式直接返回就好了，不需要处理 formItem */\n\n  if (config.mode !== 'edit') {\n    return /*#__PURE__*/React.createElement(ProFormField, _extends({\n      mode: \"read\",\n      ignoreFormItem: true,\n      fieldProps: getFieldPropsOrFormItemProps(columnProps === null || columnProps === void 0 ? void 0 : columnProps.fieldProps, null, columnProps)\n    }, proFieldProps));\n  }\n\n  return /*#__PURE__*/React.createElement(CellRenderFromItem, _extends({\n    key: config.recordKey\n  }, config, {\n    proFieldProps: proFieldProps\n  }));\n}\n\nexport default cellRenderToFromItem;","map":{"version":3,"sources":["/Users/jameszow/Documents/RustWorkSpace/covid-ipfs/covid-ipfs-client/node_modules/@ant-design/pro-table/es/utils/cellRenderToFromItem.js"],"names":["_toConsumableArray","_extends","_objectWithoutProperties","_objectSpread","_slicedToArray","_excluded","FieldContext","ProFormDependency","ProFormField","getFieldPropsOrFormItemProps","InlineErrorFormItem","runFunction","React","useCallback","useContext","useEffect","useMemo","useState","SHOW_EMPTY_TEXT_LIST","undefined","spellNamePath","_len","arguments","length","rest","Array","_key","filter","index","map","item","toString","flat","CellRenderFromItem","props","formContext","columnProps","prefixName","text","counter","rowData","recordKey","subName","proFieldProps","editableForm","key","_useState","_ref","_columnProps$key","dataIndex","_useState2","formItemName","setName","rowName","slice","_ref2","_columnProps$key2","value","join","needProps","rowKey","rowIndex","isEditable","InlineItem","_ref3","children","restProps","createElement","popoverProps","getPopupContainer","rootDomRef","current","document","body","errorType","name","generateFormItem","_ref4","_ref5","formItemProps","apply","concat","messageVariables","label","title","type","valueType","initialValue","fieldDom","cacheForSwr","proFormFieldKey","ignoreFormItem","fieldProps","renderFormItem","defaultRender","record","getFieldValue","editableUtils","Fragment","cellRenderToFromItem","config","_columnProps$dataInde","includes","valueEnum","mode","columnEmptyText","columnKey","request","params","readonly","emptyText","proFieldKey"],"mappings":"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","sourcesContent":["import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nvar _excluded = [\"children\"];\nimport { FieldContext, ProFormDependency, ProFormField } from '@ant-design/pro-form';\nimport { getFieldPropsOrFormItemProps, InlineErrorFormItem, runFunction } from '@ant-design/pro-utils';\nimport React, { useCallback, useContext, useEffect, useMemo, useState } from 'react';\nvar SHOW_EMPTY_TEXT_LIST = ['', null, undefined];\n/**\n * 拼接用于编辑的 key\n */\n\nexport var spellNamePath = function spellNamePath() {\n  for (var _len = arguments.length, rest = new Array(_len), _key = 0; _key < _len; _key++) {\n    rest[_key] = arguments[_key];\n  }\n\n  return rest.filter(function (index) {\n    return index !== undefined;\n  }).map(function (item) {\n    if (typeof item === 'number') {\n      return item.toString();\n    }\n\n    return item;\n  }).flat(1);\n};\n\nvar CellRenderFromItem = function CellRenderFromItem(props) {\n  var formContext = useContext(FieldContext);\n  var columnProps = props.columnProps,\n      prefixName = props.prefixName,\n      text = props.text,\n      counter = props.counter,\n      rowData = props.rowData,\n      index = props.index,\n      recordKey = props.recordKey,\n      subName = props.subName,\n      proFieldProps = props.proFieldProps;\n  var editableForm = counter.editableForm;\n  var key = recordKey || index;\n\n  var _useState = useState(function () {\n    var _ref, _columnProps$key;\n\n    return spellNamePath(prefixName, prefixName ? subName : [], prefixName ? index : key, (_ref = (_columnProps$key = columnProps === null || columnProps === void 0 ? void 0 : columnProps.key) !== null && _columnProps$key !== void 0 ? _columnProps$key : columnProps === null || columnProps === void 0 ? void 0 : columnProps.dataIndex) !== null && _ref !== void 0 ? _ref : index);\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      formItemName = _useState2[0],\n      setName = _useState2[1];\n\n  var rowName = useMemo(function () {\n    return formItemName.slice(0, -1);\n  }, [formItemName]);\n  useEffect(function () {\n    var _ref2, _columnProps$key2;\n\n    var value = spellNamePath(prefixName, prefixName ? subName : [], prefixName ? index : key, (_ref2 = (_columnProps$key2 = columnProps === null || columnProps === void 0 ? void 0 : columnProps.key) !== null && _columnProps$key2 !== void 0 ? _columnProps$key2 : columnProps === null || columnProps === void 0 ? void 0 : columnProps.dataIndex) !== null && _ref2 !== void 0 ? _ref2 : index);\n    if (value.join('-') !== formItemName.join('-')) setName(value);\n  }, [columnProps === null || columnProps === void 0 ? void 0 : columnProps.dataIndex, columnProps === null || columnProps === void 0 ? void 0 : columnProps.key, index, recordKey, prefixName, key, subName, formItemName]);\n  var needProps = useMemo(function () {\n    return [editableForm, _objectSpread(_objectSpread({}, columnProps), {}, {\n      rowKey: rowName,\n      rowIndex: index,\n      isEditable: true\n    })];\n  }, [columnProps, editableForm, index, rowName]);\n  var InlineItem = useCallback(function (_ref3) {\n    var children = _ref3.children,\n        restProps = _objectWithoutProperties(_ref3, _excluded);\n\n    return /*#__PURE__*/React.createElement(InlineErrorFormItem, _extends({\n      popoverProps: {\n        getPopupContainer: formContext.getPopupContainer || function () {\n          return counter.rootDomRef.current || document.body;\n        }\n      },\n      key: key,\n      errorType: \"popover\",\n      name: formItemName\n    }, restProps), children);\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [key, formItemName]);\n  var generateFormItem = useCallback(function () {\n    var _ref4, _ref5;\n\n    var formItemProps = _objectSpread({}, getFieldPropsOrFormItemProps.apply(void 0, [columnProps === null || columnProps === void 0 ? void 0 : columnProps.formItemProps].concat(_toConsumableArray(needProps))));\n\n    formItemProps.messageVariables = _objectSpread({\n      label: (columnProps === null || columnProps === void 0 ? void 0 : columnProps.title) || '此项',\n      type: (columnProps === null || columnProps === void 0 ? void 0 : columnProps.valueType) || '文本'\n    }, formItemProps === null || formItemProps === void 0 ? void 0 : formItemProps.messageVariables);\n    formItemProps.initialValue = (_ref4 = (_ref5 = prefixName ? null : text) !== null && _ref5 !== void 0 ? _ref5 : formItemProps === null || formItemProps === void 0 ? void 0 : formItemProps.initialValue) !== null && _ref4 !== void 0 ? _ref4 : columnProps === null || columnProps === void 0 ? void 0 : columnProps.initialValue;\n    var fieldDom = /*#__PURE__*/React.createElement(ProFormField, _extends({\n      cacheForSwr: true,\n      key: formItemName.join('-'),\n      name: formItemName,\n      proFormFieldKey: key,\n      ignoreFormItem: true,\n      fieldProps: getFieldPropsOrFormItemProps.apply(void 0, [columnProps === null || columnProps === void 0 ? void 0 : columnProps.fieldProps].concat(_toConsumableArray(needProps)))\n    }, proFieldProps));\n    /**\n     * 如果没有自定义直接返回\n     */\n\n    if (columnProps === null || columnProps === void 0 ? void 0 : columnProps.renderFormItem) {\n      fieldDom = columnProps.renderFormItem(_objectSpread(_objectSpread({}, columnProps), {}, {\n        index: index,\n        isEditable: true,\n        type: 'table'\n      }), {\n        defaultRender: function defaultRender() {\n          return /*#__PURE__*/React.createElement(InlineItem, formItemProps, fieldDom);\n        },\n        type: 'form',\n        recordKey: recordKey,\n        record: _objectSpread(_objectSpread({}, rowData), editableForm === null || editableForm === void 0 ? void 0 : editableForm.getFieldValue([key])),\n        isEditable: true\n      }, editableForm, props.editableUtils); // 如果需要完全自定义可以不要name\n\n      if (columnProps.ignoreFormItem) return /*#__PURE__*/React.createElement(React.Fragment, null, fieldDom);\n    }\n\n    return /*#__PURE__*/React.createElement(InlineItem, _extends({\n      key: formItemName.join('-')\n    }, formItemProps), fieldDom);\n  }, [columnProps, needProps, prefixName, text, key, formItemName, proFieldProps, InlineItem, index, recordKey, rowData, editableForm, props.editableUtils]);\n  if (formItemName.length === 0) return null;\n\n  if (typeof (columnProps === null || columnProps === void 0 ? void 0 : columnProps.renderFormItem) === 'function' || typeof (columnProps === null || columnProps === void 0 ? void 0 : columnProps.fieldProps) === 'function' || typeof (columnProps === null || columnProps === void 0 ? void 0 : columnProps.formItemProps) === 'function') {\n    return /*#__PURE__*/React.createElement(ProFormDependency, {\n      name: [rowName]\n    }, function () {\n      return generateFormItem();\n    });\n  }\n\n  return generateFormItem();\n};\n/**\n * 根据不同的类型来转化数值\n *\n * @param text\n * @param valueType\n */\n\n\nfunction cellRenderToFromItem(config) {\n  var _columnProps$dataInde;\n\n  var text = config.text,\n      valueType = config.valueType,\n      rowData = config.rowData,\n      columnProps = config.columnProps; // 如果 valueType === text ，没必要多走一次 render\n\n  if ((!valueType || ['textarea', 'text'].includes(valueType.toString())) && // valueEnum 存在说明是个select\n  !(columnProps === null || columnProps === void 0 ? void 0 : columnProps.valueEnum) && config.mode === 'read') {\n    // 如果是''、null、undefined 显示columnEmptyText\n    return SHOW_EMPTY_TEXT_LIST.includes(text) ? config.columnEmptyText : text;\n  }\n\n  if (typeof valueType === 'function' && rowData) {\n    // 防止valueType是函数,并且text是''、null、undefined跳过显式设置的columnEmptyText\n    return cellRenderToFromItem(_objectSpread(_objectSpread({}, config), {}, {\n      valueType: valueType(rowData, config.type) || 'text'\n    }));\n  }\n\n  var columnKey = (columnProps === null || columnProps === void 0 ? void 0 : columnProps.key) || (columnProps === null || columnProps === void 0 ? void 0 : (_columnProps$dataInde = columnProps.dataIndex) === null || _columnProps$dataInde === void 0 ? void 0 : _columnProps$dataInde.toString());\n  /**\n   * 生成公用的 proField dom 配置\n   */\n\n  var proFieldProps = {\n    valueEnum: runFunction(columnProps === null || columnProps === void 0 ? void 0 : columnProps.valueEnum, rowData),\n    request: columnProps === null || columnProps === void 0 ? void 0 : columnProps.request,\n    params: runFunction(columnProps === null || columnProps === void 0 ? void 0 : columnProps.params, rowData, columnProps),\n    readonly: columnProps === null || columnProps === void 0 ? void 0 : columnProps.readonly,\n    text: valueType === 'index' || valueType === 'indexBorder' ? config.index : text,\n    mode: config.mode,\n    renderFormItem: undefined,\n    valueType: valueType,\n    // @ts-ignore\n    record: rowData,\n    proFieldProps: {\n      emptyText: config.columnEmptyText,\n      proFieldKey: columnKey ? \"table-field-\".concat(columnKey) : undefined\n    }\n  };\n  /** 只读模式直接返回就好了，不需要处理 formItem */\n\n  if (config.mode !== 'edit') {\n    return /*#__PURE__*/React.createElement(ProFormField, _extends({\n      mode: \"read\",\n      ignoreFormItem: true,\n      fieldProps: getFieldPropsOrFormItemProps(columnProps === null || columnProps === void 0 ? void 0 : columnProps.fieldProps, null, columnProps)\n    }, proFieldProps));\n  }\n\n  return /*#__PURE__*/React.createElement(CellRenderFromItem, _extends({\n    key: config.recordKey\n  }, config, {\n    proFieldProps: proFieldProps\n  }));\n}\n\nexport default cellRenderToFromItem;"]},"metadata":{},"sourceType":"module"}