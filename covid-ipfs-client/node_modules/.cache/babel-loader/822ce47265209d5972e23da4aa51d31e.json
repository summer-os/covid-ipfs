{"ast":null,"code":"import \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime/helpers/esm/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport \"antd/es/config-provider/style\";\nimport _ConfigProvider from \"antd/es/config-provider\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _excluded = [\"children\", \"trigger\", \"onVisibleChange\", \"modalProps\", \"onFinish\", \"submitTimeout\", \"title\", \"width\", \"visible\"];\nimport merge from 'lodash/merge';\nimport useMergedState from \"rc-util/es/hooks/useMergedState\";\nimport { noteOnce } from \"rc-util/es/warning\";\nimport React, { useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport { BaseForm } from '../../BaseForm';\n\nfunction ModalForm(_ref) {\n  var _context$locale3, _context$locale3$Moda, _context$locale4, _context$locale4$Moda;\n\n  var children = _ref.children,\n      trigger = _ref.trigger,\n      onVisibleChange = _ref.onVisibleChange,\n      modalProps = _ref.modalProps,\n      onFinish = _ref.onFinish,\n      submitTimeout = _ref.submitTimeout,\n      title = _ref.title,\n      width = _ref.width,\n      propVisible = _ref.visible,\n      rest = _objectWithoutProperties(_ref, _excluded);\n\n  noteOnce( // eslint-disable-next-line @typescript-eslint/dot-notation\n  !rest['footer'] || !(modalProps === null || modalProps === void 0 ? void 0 : modalProps.footer), 'ModalForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。');\n  var context = useContext(_ConfigProvider.ConfigContext);\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      forceUpdate = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  var _useMergedState = useMergedState(!!propVisible, {\n    value: propVisible,\n    onChange: onVisibleChange\n  }),\n      _useMergedState2 = _slicedToArray(_useMergedState, 2),\n      visible = _useMergedState2[0],\n      setVisible = _useMergedState2[1];\n\n  var footerRef = useRef(null);\n  var footerDomRef = useCallback(function (element) {\n    if (footerRef.current === null && element) {\n      forceUpdate([]);\n    }\n\n    footerRef.current = element;\n  }, []);\n  var formRef = useRef();\n  useEffect(function () {\n    if (visible && propVisible) {\n      onVisibleChange === null || onVisibleChange === void 0 ? void 0 : onVisibleChange(true);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [propVisible, visible]);\n  var triggerDom = useMemo(function () {\n    if (!trigger) {\n      return null;\n    }\n\n    return /*#__PURE__*/React.cloneElement(trigger, _objectSpread(_objectSpread({\n      key: 'trigger'\n    }, trigger.props), {}, {\n      onClick: function () {\n        var _onClick = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(e) {\n          var _trigger$props, _trigger$props$onClic;\n\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  setVisible(!visible);\n                  (_trigger$props = trigger.props) === null || _trigger$props === void 0 ? void 0 : (_trigger$props$onClic = _trigger$props.onClick) === null || _trigger$props$onClic === void 0 ? void 0 : _trigger$props$onClic.call(_trigger$props, e);\n\n                case 2:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        function onClick(_x) {\n          return _onClick.apply(this, arguments);\n        }\n\n        return onClick;\n      }()\n    }));\n  }, [setVisible, trigger, visible]);\n  var submitterConfig = useMemo(function () {\n    var _ref2, _modalProps$okText, _context$locale, _context$locale$Modal, _ref3, _modalProps$cancelTex, _context$locale2, _context$locale2$Moda;\n\n    if (rest.submitter === false) {\n      return false;\n    }\n\n    return merge({\n      searchConfig: {\n        submitText: (_ref2 = (_modalProps$okText = modalProps === null || modalProps === void 0 ? void 0 : modalProps.okText) !== null && _modalProps$okText !== void 0 ? _modalProps$okText : (_context$locale = context.locale) === null || _context$locale === void 0 ? void 0 : (_context$locale$Modal = _context$locale.Modal) === null || _context$locale$Modal === void 0 ? void 0 : _context$locale$Modal.okText) !== null && _ref2 !== void 0 ? _ref2 : '确认',\n        resetText: (_ref3 = (_modalProps$cancelTex = modalProps === null || modalProps === void 0 ? void 0 : modalProps.cancelText) !== null && _modalProps$cancelTex !== void 0 ? _modalProps$cancelTex : (_context$locale2 = context.locale) === null || _context$locale2 === void 0 ? void 0 : (_context$locale2$Moda = _context$locale2.Modal) === null || _context$locale2$Moda === void 0 ? void 0 : _context$locale2$Moda.cancelText) !== null && _ref3 !== void 0 ? _ref3 : '取消'\n      },\n      resetButtonProps: {\n        preventDefault: true,\n        // 提交表单loading时，不可关闭弹框\n        disabled: submitTimeout ? loading : undefined,\n        onClick: function onClick(e) {\n          var _modalProps$onCancel;\n\n          setVisible(false);\n          modalProps === null || modalProps === void 0 ? void 0 : (_modalProps$onCancel = modalProps.onCancel) === null || _modalProps$onCancel === void 0 ? void 0 : _modalProps$onCancel.call(modalProps, e);\n        }\n      }\n    }, rest.submitter);\n  }, [(_context$locale3 = context.locale) === null || _context$locale3 === void 0 ? void 0 : (_context$locale3$Moda = _context$locale3.Modal) === null || _context$locale3$Moda === void 0 ? void 0 : _context$locale3$Moda.cancelText, (_context$locale4 = context.locale) === null || _context$locale4 === void 0 ? void 0 : (_context$locale4$Moda = _context$locale4.Modal) === null || _context$locale4$Moda === void 0 ? void 0 : _context$locale4$Moda.okText, modalProps, rest.submitter, setVisible, loading, submitTimeout]);\n  var contentRender = useCallback(function (formDom, submitter) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, formDom, footerRef.current && submitter ? /*#__PURE__*/createPortal(submitter, footerRef.current) : submitter);\n  }, []);\n  var onFinishHandle = useCallback( /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(values) {\n      var response, timer, result;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              response = onFinish === null || onFinish === void 0 ? void 0 : onFinish(values);\n\n              if (submitTimeout && response instanceof Promise) {\n                setLoading(true);\n                timer = setTimeout(function () {\n                  return setLoading(false);\n                }, submitTimeout);\n                response.finally(function () {\n                  clearTimeout(timer);\n                  setLoading(false);\n                });\n              }\n\n              _context2.next = 4;\n              return response;\n\n            case 4:\n              result = _context2.sent; // 返回真值，关闭弹框\n\n              if (result) {\n                setVisible(false);\n              }\n\n              return _context2.abrupt(\"return\", result);\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }(), [onFinish, setVisible, submitTimeout]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(_Modal, _extends({\n    title: title,\n    width: width || 800\n  }, modalProps, {\n    visible: visible,\n    onCancel: function onCancel(e) {\n      var _modalProps$onCancel2; // 提交表单loading时，阻止弹框关闭\n\n\n      if (submitTimeout && loading) return;\n      setVisible(false);\n      modalProps === null || modalProps === void 0 ? void 0 : (_modalProps$onCancel2 = modalProps.onCancel) === null || _modalProps$onCancel2 === void 0 ? void 0 : _modalProps$onCancel2.call(modalProps, e);\n    },\n    footer: rest.submitter !== false && /*#__PURE__*/React.createElement(\"div\", {\n      ref: footerDomRef,\n      style: {\n        display: 'flex',\n        justifyContent: 'flex-end'\n      }\n    })\n  }), /*#__PURE__*/React.createElement(BaseForm, _extends({\n    formComponentType: \"ModalForm\",\n    layout: \"vertical\",\n    formRef: formRef\n  }, rest, {\n    submitter: submitterConfig,\n    onFinish: /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(values) {\n        var _rest$formRef$current, _rest$formRef;\n\n        var result, form;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return onFinishHandle(values);\n\n              case 2:\n                result = _context3.sent;\n                form = (_rest$formRef$current = (_rest$formRef = rest.formRef) === null || _rest$formRef === void 0 ? void 0 : _rest$formRef.current) !== null && _rest$formRef$current !== void 0 ? _rest$formRef$current : formRef.current; // 返回真值，重置表单\n\n                if (result && form) {\n                  form.resetFields();\n                }\n\n                return _context3.abrupt(\"return\", result);\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x3) {\n        return _ref5.apply(this, arguments);\n      };\n    }(),\n    contentRender: contentRender\n  }), children)), triggerDom);\n}\n\nexport { ModalForm };","map":{"version":3,"sources":["/Users/jameszow/Documents/RustWorkSpace/covid-ipfs/covid-ipfs-client/node_modules/@ant-design/pro-form/es/layouts/ModalForm/index.js"],"names":["_Modal","_extends","_regeneratorRuntime","_asyncToGenerator","_objectSpread","_slicedToArray","_ConfigProvider","_objectWithoutProperties","_excluded","merge","useMergedState","noteOnce","React","useCallback","useContext","useEffect","useMemo","useRef","useState","createPortal","BaseForm","ModalForm","_ref","_context$locale3","_context$locale3$Moda","_context$locale4","_context$locale4$Moda","children","trigger","onVisibleChange","modalProps","onFinish","submitTimeout","title","width","propVisible","visible","rest","footer","context","ConfigContext","_useState","_useState2","forceUpdate","_useState3","_useState4","loading","setLoading","_useMergedState","value","onChange","_useMergedState2","setVisible","footerRef","footerDomRef","element","current","formRef","triggerDom","cloneElement","key","props","onClick","_onClick","mark","_callee","e","_trigger$props","_trigger$props$onClic","wrap","_callee$","_context","prev","next","call","stop","_x","apply","arguments","submitterConfig","_ref2","_modalProps$okText","_context$locale","_context$locale$Modal","_ref3","_modalProps$cancelTex","_context$locale2","_context$locale2$Moda","submitter","searchConfig","submitText","okText","locale","Modal","resetText","cancelText","resetButtonProps","preventDefault","disabled","undefined","_modalProps$onCancel","onCancel","contentRender","formDom","createElement","Fragment","onFinishHandle","_ref4","_callee2","values","response","timer","result","_callee2$","_context2","Promise","setTimeout","finally","clearTimeout","sent","abrupt","_x2","_modalProps$onCancel2","ref","style","display","justifyContent","formComponentType","layout","_ref5","_callee3","_rest$formRef$current","_rest$formRef","form","_callee3$","_context3","resetFields","_x3"],"mappings":"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","sourcesContent":["import \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime/helpers/esm/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport \"antd/es/config-provider/style\";\nimport _ConfigProvider from \"antd/es/config-provider\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _excluded = [\"children\", \"trigger\", \"onVisibleChange\", \"modalProps\", \"onFinish\", \"submitTimeout\", \"title\", \"width\", \"visible\"];\nimport merge from 'lodash/merge';\nimport useMergedState from \"rc-util/es/hooks/useMergedState\";\nimport { noteOnce } from \"rc-util/es/warning\";\nimport React, { useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport { BaseForm } from '../../BaseForm';\n\nfunction ModalForm(_ref) {\n  var _context$locale3, _context$locale3$Moda, _context$locale4, _context$locale4$Moda;\n\n  var children = _ref.children,\n      trigger = _ref.trigger,\n      onVisibleChange = _ref.onVisibleChange,\n      modalProps = _ref.modalProps,\n      onFinish = _ref.onFinish,\n      submitTimeout = _ref.submitTimeout,\n      title = _ref.title,\n      width = _ref.width,\n      propVisible = _ref.visible,\n      rest = _objectWithoutProperties(_ref, _excluded);\n\n  noteOnce( // eslint-disable-next-line @typescript-eslint/dot-notation\n  !rest['footer'] || !(modalProps === null || modalProps === void 0 ? void 0 : modalProps.footer), 'ModalForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。');\n  var context = useContext(_ConfigProvider.ConfigContext);\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      forceUpdate = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  var _useMergedState = useMergedState(!!propVisible, {\n    value: propVisible,\n    onChange: onVisibleChange\n  }),\n      _useMergedState2 = _slicedToArray(_useMergedState, 2),\n      visible = _useMergedState2[0],\n      setVisible = _useMergedState2[1];\n\n  var footerRef = useRef(null);\n  var footerDomRef = useCallback(function (element) {\n    if (footerRef.current === null && element) {\n      forceUpdate([]);\n    }\n\n    footerRef.current = element;\n  }, []);\n  var formRef = useRef();\n  useEffect(function () {\n    if (visible && propVisible) {\n      onVisibleChange === null || onVisibleChange === void 0 ? void 0 : onVisibleChange(true);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [propVisible, visible]);\n  var triggerDom = useMemo(function () {\n    if (!trigger) {\n      return null;\n    }\n\n    return /*#__PURE__*/React.cloneElement(trigger, _objectSpread(_objectSpread({\n      key: 'trigger'\n    }, trigger.props), {}, {\n      onClick: function () {\n        var _onClick = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(e) {\n          var _trigger$props, _trigger$props$onClic;\n\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  setVisible(!visible);\n                  (_trigger$props = trigger.props) === null || _trigger$props === void 0 ? void 0 : (_trigger$props$onClic = _trigger$props.onClick) === null || _trigger$props$onClic === void 0 ? void 0 : _trigger$props$onClic.call(_trigger$props, e);\n\n                case 2:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        function onClick(_x) {\n          return _onClick.apply(this, arguments);\n        }\n\n        return onClick;\n      }()\n    }));\n  }, [setVisible, trigger, visible]);\n  var submitterConfig = useMemo(function () {\n    var _ref2, _modalProps$okText, _context$locale, _context$locale$Modal, _ref3, _modalProps$cancelTex, _context$locale2, _context$locale2$Moda;\n\n    if (rest.submitter === false) {\n      return false;\n    }\n\n    return merge({\n      searchConfig: {\n        submitText: (_ref2 = (_modalProps$okText = modalProps === null || modalProps === void 0 ? void 0 : modalProps.okText) !== null && _modalProps$okText !== void 0 ? _modalProps$okText : (_context$locale = context.locale) === null || _context$locale === void 0 ? void 0 : (_context$locale$Modal = _context$locale.Modal) === null || _context$locale$Modal === void 0 ? void 0 : _context$locale$Modal.okText) !== null && _ref2 !== void 0 ? _ref2 : '确认',\n        resetText: (_ref3 = (_modalProps$cancelTex = modalProps === null || modalProps === void 0 ? void 0 : modalProps.cancelText) !== null && _modalProps$cancelTex !== void 0 ? _modalProps$cancelTex : (_context$locale2 = context.locale) === null || _context$locale2 === void 0 ? void 0 : (_context$locale2$Moda = _context$locale2.Modal) === null || _context$locale2$Moda === void 0 ? void 0 : _context$locale2$Moda.cancelText) !== null && _ref3 !== void 0 ? _ref3 : '取消'\n      },\n      resetButtonProps: {\n        preventDefault: true,\n        // 提交表单loading时，不可关闭弹框\n        disabled: submitTimeout ? loading : undefined,\n        onClick: function onClick(e) {\n          var _modalProps$onCancel;\n\n          setVisible(false);\n          modalProps === null || modalProps === void 0 ? void 0 : (_modalProps$onCancel = modalProps.onCancel) === null || _modalProps$onCancel === void 0 ? void 0 : _modalProps$onCancel.call(modalProps, e);\n        }\n      }\n    }, rest.submitter);\n  }, [(_context$locale3 = context.locale) === null || _context$locale3 === void 0 ? void 0 : (_context$locale3$Moda = _context$locale3.Modal) === null || _context$locale3$Moda === void 0 ? void 0 : _context$locale3$Moda.cancelText, (_context$locale4 = context.locale) === null || _context$locale4 === void 0 ? void 0 : (_context$locale4$Moda = _context$locale4.Modal) === null || _context$locale4$Moda === void 0 ? void 0 : _context$locale4$Moda.okText, modalProps, rest.submitter, setVisible, loading, submitTimeout]);\n  var contentRender = useCallback(function (formDom, submitter) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, formDom, footerRef.current && submitter ? /*#__PURE__*/createPortal(submitter, footerRef.current) : submitter);\n  }, []);\n  var onFinishHandle = useCallback( /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(values) {\n      var response, timer, result;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              response = onFinish === null || onFinish === void 0 ? void 0 : onFinish(values);\n\n              if (submitTimeout && response instanceof Promise) {\n                setLoading(true);\n                timer = setTimeout(function () {\n                  return setLoading(false);\n                }, submitTimeout);\n                response.finally(function () {\n                  clearTimeout(timer);\n                  setLoading(false);\n                });\n              }\n\n              _context2.next = 4;\n              return response;\n\n            case 4:\n              result = _context2.sent;\n\n              // 返回真值，关闭弹框\n              if (result) {\n                setVisible(false);\n              }\n\n              return _context2.abrupt(\"return\", result);\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }(), [onFinish, setVisible, submitTimeout]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(_Modal, _extends({\n    title: title,\n    width: width || 800\n  }, modalProps, {\n    visible: visible,\n    onCancel: function onCancel(e) {\n      var _modalProps$onCancel2;\n\n      // 提交表单loading时，阻止弹框关闭\n      if (submitTimeout && loading) return;\n      setVisible(false);\n      modalProps === null || modalProps === void 0 ? void 0 : (_modalProps$onCancel2 = modalProps.onCancel) === null || _modalProps$onCancel2 === void 0 ? void 0 : _modalProps$onCancel2.call(modalProps, e);\n    },\n    footer: rest.submitter !== false && /*#__PURE__*/React.createElement(\"div\", {\n      ref: footerDomRef,\n      style: {\n        display: 'flex',\n        justifyContent: 'flex-end'\n      }\n    })\n  }), /*#__PURE__*/React.createElement(BaseForm, _extends({\n    formComponentType: \"ModalForm\",\n    layout: \"vertical\",\n    formRef: formRef\n  }, rest, {\n    submitter: submitterConfig,\n    onFinish: /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(values) {\n        var _rest$formRef$current, _rest$formRef;\n\n        var result, form;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return onFinishHandle(values);\n\n              case 2:\n                result = _context3.sent;\n                form = (_rest$formRef$current = (_rest$formRef = rest.formRef) === null || _rest$formRef === void 0 ? void 0 : _rest$formRef.current) !== null && _rest$formRef$current !== void 0 ? _rest$formRef$current : formRef.current; // 返回真值，重置表单\n\n                if (result && form) {\n                  form.resetFields();\n                }\n\n                return _context3.abrupt(\"return\", result);\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x3) {\n        return _ref5.apply(this, arguments);\n      };\n    }(),\n    contentRender: contentRender\n  }), children)), triggerDom);\n}\n\nexport { ModalForm };"]},"metadata":{},"sourceType":"module"}