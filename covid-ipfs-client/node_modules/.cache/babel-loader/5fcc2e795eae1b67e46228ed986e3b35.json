{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/config-provider/style\";\nimport _ConfigProvider from \"antd/es/config-provider\";\nimport _regeneratorRuntime from \"@babel/runtime/helpers/esm/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport { BetaSchemaForm } from '@ant-design/pro-form';\nimport classNames from 'classnames';\nimport omit from 'omit.js';\nimport React, { useContext, useMemo } from 'react';\nimport './index.less';\n\nfunction toLowerLine(str) {\n  var temp = str.replace(/[A-Z]/g, function (match) {\n    return \"-\".concat(match.toLowerCase());\n  });\n\n  if (temp.startsWith('-')) {\n    // 如果首字母是大写，执行replace时会多一个_，这里需要去掉\n    temp = temp.slice(1);\n  }\n\n  return temp;\n}\n/**\n * 获取当前选择的 Form Layout 配置\n *\n * @param isForm\n * @param searchConfig\n * @returns LightFilter | QueryFilter | ProForm\n */\n\n\nvar getFormCompetent = function getFormCompetent(isForm, searchConfig) {\n  if (!isForm && searchConfig !== false) {\n    if ((searchConfig === null || searchConfig === void 0 ? void 0 : searchConfig.filterType) === 'light') {\n      return 'LightFilter';\n    }\n\n    return 'QueryFilter';\n  }\n\n  return 'Form';\n};\n/**\n * 获取需要传给相应表单的props\n *\n * @param searchConfig\n * @param name\n */\n\n\nvar getFromProps = function getFromProps(isForm, searchConfig, name) {\n  if (!isForm && name === 'LightFilter') {\n    // 传给 lightFilter 的问题\n    return omit(_objectSpread({}, searchConfig), ['labelWidth', 'defaultCollapsed', 'filterType']);\n  }\n\n  if (!isForm) {\n    // 传给 QueryFilter 的配置\n    return omit(_objectSpread({\n      labelWidth: searchConfig ? searchConfig === null || searchConfig === void 0 ? void 0 : searchConfig.labelWidth : undefined,\n      defaultCollapsed: true\n    }, searchConfig), ['filterType']);\n  }\n\n  return {};\n};\n/**\n * 从formConfig中获取传给相应表单的配置\n *\n * @param isForm\n * @param formConfig\n */\n\n\nvar getFormConfigs = function getFormConfigs(isForm, formConfig) {\n  if (isForm) {\n    // 传给Form的配置\n    return omit(formConfig, ['ignoreRules']);\n  } // 传给Filter的配置\n\n\n  return _objectSpread({\n    ignoreRules: true\n  }, formConfig);\n};\n/**\n * 这里会把 列配置转化为 form 表单\n *\n * @param param0\n * @returns\n */\n\n\nvar FormRender = function FormRender(_ref) {\n  var _classNames;\n\n  var onSubmit = _ref.onSubmit,\n      formRef = _ref.formRef,\n      _ref$dateFormatter = _ref.dateFormatter,\n      dateFormatter = _ref$dateFormatter === void 0 ? 'string' : _ref$dateFormatter,\n      type = _ref.type,\n      columns = _ref.columns,\n      action = _ref.action,\n      ghost = _ref.ghost,\n      manualRequest = _ref.manualRequest,\n      _onReset = _ref.onReset,\n      submitButtonLoading = _ref.submitButtonLoading,\n      searchConfig = _ref.search,\n      formConfig = _ref.form,\n      bordered = _ref.bordered;\n  var isForm = type === 'form';\n  /** 提交表单，根据两种模式不同，方法不相同 */\n\n  var submit = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(values, firstLoad) {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (onSubmit) {\n                onSubmit(values, firstLoad);\n              }\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function submit(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var _useContext = useContext(_ConfigProvider.ConfigContext),\n      getPrefixCls = _useContext.getPrefixCls;\n\n  var columnsList = useMemo(function () {\n    return columns.filter(function (item) {\n      if (item === _Table.EXPAND_COLUMN || item === _Table.SELECTION_COLUMN) {\n        return false;\n      }\n\n      if ((item.hideInSearch || item.search === false) && type !== 'form') {\n        return false;\n      }\n\n      if (type === 'form' && item.hideInForm) {\n        return false;\n      }\n\n      return true;\n    }).map(function (item) {\n      var _item$dataIndex;\n\n      var finalValueType = !item.valueType || ['textarea', 'jsonCode', 'code'].includes(item === null || item === void 0 ? void 0 : item.valueType) && type === 'table' ? 'text' : item === null || item === void 0 ? void 0 : item.valueType;\n      var columnKey = (item === null || item === void 0 ? void 0 : item.key) || (item === null || item === void 0 ? void 0 : (_item$dataIndex = item.dataIndex) === null || _item$dataIndex === void 0 ? void 0 : _item$dataIndex.toString());\n      return _objectSpread(_objectSpread(_objectSpread({}, item), {}, {\n        width: undefined\n      }, item.search ? item.search : {}), {}, {\n        valueType: finalValueType,\n        proFieldProps: _objectSpread(_objectSpread({}, item.proFieldProps), {}, {\n          proFieldKey: columnKey ? \"table-field-\".concat(columnKey) : undefined\n        })\n      });\n    });\n  }, [columns, type]);\n  var className = getPrefixCls('pro-table-search');\n  var formClassName = getPrefixCls('pro-table-form');\n  var competentName = useMemo(function () {\n    return getFormCompetent(isForm, searchConfig);\n  }, [searchConfig, isForm]); // 传给每个表单的配置，理论上大家都需要\n\n  var loadingProps = useMemo(function () {\n    return {\n      submitter: {\n        submitButtonProps: {\n          loading: submitButtonLoading\n        }\n      }\n    };\n  }, [submitButtonLoading]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames((_classNames = {}, _defineProperty(_classNames, getPrefixCls('pro-card'), true), _defineProperty(_classNames, \"\".concat(getPrefixCls('pro-card'), \"-border\"), !!bordered), _defineProperty(_classNames, \"\".concat(getPrefixCls('pro-card'), \"-bordered\"), !!bordered), _defineProperty(_classNames, \"\".concat(getPrefixCls('pro-card'), \"-ghost\"), !!ghost), _defineProperty(_classNames, className, true), _defineProperty(_classNames, formClassName, isForm), _defineProperty(_classNames, getPrefixCls(\"pro-table-search-\".concat(toLowerLine(competentName))), true), _defineProperty(_classNames, \"\".concat(className, \"-ghost\"), ghost), _defineProperty(_classNames, searchConfig === null || searchConfig === void 0 ? void 0 : searchConfig.className, searchConfig !== false && (searchConfig === null || searchConfig === void 0 ? void 0 : searchConfig.className)), _classNames))\n  }, /*#__PURE__*/React.createElement(BetaSchemaForm, _extends({\n    layoutType: competentName,\n    columns: columnsList,\n    type: type\n  }, loadingProps, getFromProps(isForm, searchConfig, competentName), getFormConfigs(isForm, formConfig || {}), {\n    formRef: formRef,\n    action: action,\n    dateFormatter: dateFormatter,\n    onInit: function onInit(values) {\n      // 触发一个 submit，之所以这里触发是为了保证 value 都被 format了\n      if (type !== 'form') {\n        var _action$current, _action$current2, _action$current2$setP; // 修改 pageSize，变成从 url 中获取的\n\n\n        var pageInfo = (_action$current = action.current) === null || _action$current === void 0 ? void 0 : _action$current.pageInfo; // 从 values 里获取是因为有时候要从 url中获取的 pageSize。\n\n        var _values$current = values.current,\n            current = _values$current === void 0 ? pageInfo === null || pageInfo === void 0 ? void 0 : pageInfo.current : _values$current,\n            _values$pageSize = values.pageSize,\n            pageSize = _values$pageSize === void 0 ? pageInfo === null || pageInfo === void 0 ? void 0 : pageInfo.pageSize : _values$pageSize;\n        (_action$current2 = action.current) === null || _action$current2 === void 0 ? void 0 : (_action$current2$setP = _action$current2.setPageInfo) === null || _action$current2$setP === void 0 ? void 0 : _action$current2$setP.call(_action$current2, _objectSpread(_objectSpread({}, pageInfo), {}, {\n          current: parseInt(current, 10),\n          pageSize: parseInt(pageSize, 10)\n        }));\n        /** 如果是手动模式不需要提交 */\n\n        if (manualRequest) return;\n        submit(values, true);\n      }\n    },\n    onReset: function onReset(values) {\n      _onReset === null || _onReset === void 0 ? void 0 : _onReset(values);\n    },\n    onFinish: function onFinish(values) {\n      submit(values, false);\n    },\n    initialValues: formConfig === null || formConfig === void 0 ? void 0 : formConfig.initialValues\n  })));\n};\n\nexport default FormRender;","map":{"version":3,"sources":["/Users/jameszow/Documents/RustWorkSpace/covid-ipfs/covid-ipfs-client/node_modules/@ant-design/pro-table/es/components/Form/FormRender.js"],"names":["_extends","_defineProperty","_Table","_ConfigProvider","_regeneratorRuntime","_asyncToGenerator","_objectSpread","BetaSchemaForm","classNames","omit","React","useContext","useMemo","toLowerLine","str","temp","replace","match","concat","toLowerCase","startsWith","slice","getFormCompetent","isForm","searchConfig","filterType","getFromProps","name","labelWidth","undefined","defaultCollapsed","getFormConfigs","formConfig","ignoreRules","FormRender","_ref","_classNames","onSubmit","formRef","_ref$dateFormatter","dateFormatter","type","columns","action","ghost","manualRequest","_onReset","onReset","submitButtonLoading","search","form","bordered","submit","_ref2","mark","_callee","values","firstLoad","wrap","_callee$","_context","prev","next","stop","_x","_x2","apply","arguments","_useContext","ConfigContext","getPrefixCls","columnsList","filter","item","EXPAND_COLUMN","SELECTION_COLUMN","hideInSearch","hideInForm","map","_item$dataIndex","finalValueType","valueType","includes","columnKey","key","dataIndex","toString","width","proFieldProps","proFieldKey","className","formClassName","competentName","loadingProps","submitter","submitButtonProps","loading","createElement","layoutType","onInit","_action$current","_action$current2","_action$current2$setP","pageInfo","current","_values$current","_values$pageSize","pageSize","setPageInfo","call","parseInt","onFinish","initialValues"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/config-provider/style\";\nimport _ConfigProvider from \"antd/es/config-provider\";\nimport _regeneratorRuntime from \"@babel/runtime/helpers/esm/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport { BetaSchemaForm } from '@ant-design/pro-form';\nimport classNames from 'classnames';\nimport omit from 'omit.js';\nimport React, { useContext, useMemo } from 'react';\nimport './index.less';\n\nfunction toLowerLine(str) {\n  var temp = str.replace(/[A-Z]/g, function (match) {\n    return \"-\".concat(match.toLowerCase());\n  });\n\n  if (temp.startsWith('-')) {\n    // 如果首字母是大写，执行replace时会多一个_，这里需要去掉\n    temp = temp.slice(1);\n  }\n\n  return temp;\n}\n/**\n * 获取当前选择的 Form Layout 配置\n *\n * @param isForm\n * @param searchConfig\n * @returns LightFilter | QueryFilter | ProForm\n */\n\n\nvar getFormCompetent = function getFormCompetent(isForm, searchConfig) {\n  if (!isForm && searchConfig !== false) {\n    if ((searchConfig === null || searchConfig === void 0 ? void 0 : searchConfig.filterType) === 'light') {\n      return 'LightFilter';\n    }\n\n    return 'QueryFilter';\n  }\n\n  return 'Form';\n};\n/**\n * 获取需要传给相应表单的props\n *\n * @param searchConfig\n * @param name\n */\n\n\nvar getFromProps = function getFromProps(isForm, searchConfig, name) {\n  if (!isForm && name === 'LightFilter') {\n    // 传给 lightFilter 的问题\n    return omit(_objectSpread({}, searchConfig), ['labelWidth', 'defaultCollapsed', 'filterType']);\n  }\n\n  if (!isForm) {\n    // 传给 QueryFilter 的配置\n    return omit(_objectSpread({\n      labelWidth: searchConfig ? searchConfig === null || searchConfig === void 0 ? void 0 : searchConfig.labelWidth : undefined,\n      defaultCollapsed: true\n    }, searchConfig), ['filterType']);\n  }\n\n  return {};\n};\n/**\n * 从formConfig中获取传给相应表单的配置\n *\n * @param isForm\n * @param formConfig\n */\n\n\nvar getFormConfigs = function getFormConfigs(isForm, formConfig) {\n  if (isForm) {\n    // 传给Form的配置\n    return omit(formConfig, ['ignoreRules']);\n  } // 传给Filter的配置\n\n\n  return _objectSpread({\n    ignoreRules: true\n  }, formConfig);\n};\n/**\n * 这里会把 列配置转化为 form 表单\n *\n * @param param0\n * @returns\n */\n\n\nvar FormRender = function FormRender(_ref) {\n  var _classNames;\n\n  var onSubmit = _ref.onSubmit,\n      formRef = _ref.formRef,\n      _ref$dateFormatter = _ref.dateFormatter,\n      dateFormatter = _ref$dateFormatter === void 0 ? 'string' : _ref$dateFormatter,\n      type = _ref.type,\n      columns = _ref.columns,\n      action = _ref.action,\n      ghost = _ref.ghost,\n      manualRequest = _ref.manualRequest,\n      _onReset = _ref.onReset,\n      submitButtonLoading = _ref.submitButtonLoading,\n      searchConfig = _ref.search,\n      formConfig = _ref.form,\n      bordered = _ref.bordered;\n  var isForm = type === 'form';\n  /** 提交表单，根据两种模式不同，方法不相同 */\n\n  var submit = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(values, firstLoad) {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (onSubmit) {\n                onSubmit(values, firstLoad);\n              }\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function submit(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var _useContext = useContext(_ConfigProvider.ConfigContext),\n      getPrefixCls = _useContext.getPrefixCls;\n\n  var columnsList = useMemo(function () {\n    return columns.filter(function (item) {\n      if (item === _Table.EXPAND_COLUMN || item === _Table.SELECTION_COLUMN) {\n        return false;\n      }\n\n      if ((item.hideInSearch || item.search === false) && type !== 'form') {\n        return false;\n      }\n\n      if (type === 'form' && item.hideInForm) {\n        return false;\n      }\n\n      return true;\n    }).map(function (item) {\n      var _item$dataIndex;\n\n      var finalValueType = !item.valueType || ['textarea', 'jsonCode', 'code'].includes(item === null || item === void 0 ? void 0 : item.valueType) && type === 'table' ? 'text' : item === null || item === void 0 ? void 0 : item.valueType;\n      var columnKey = (item === null || item === void 0 ? void 0 : item.key) || (item === null || item === void 0 ? void 0 : (_item$dataIndex = item.dataIndex) === null || _item$dataIndex === void 0 ? void 0 : _item$dataIndex.toString());\n      return _objectSpread(_objectSpread(_objectSpread({}, item), {}, {\n        width: undefined\n      }, item.search ? item.search : {}), {}, {\n        valueType: finalValueType,\n        proFieldProps: _objectSpread(_objectSpread({}, item.proFieldProps), {}, {\n          proFieldKey: columnKey ? \"table-field-\".concat(columnKey) : undefined\n        })\n      });\n    });\n  }, [columns, type]);\n  var className = getPrefixCls('pro-table-search');\n  var formClassName = getPrefixCls('pro-table-form');\n  var competentName = useMemo(function () {\n    return getFormCompetent(isForm, searchConfig);\n  }, [searchConfig, isForm]); // 传给每个表单的配置，理论上大家都需要\n\n  var loadingProps = useMemo(function () {\n    return {\n      submitter: {\n        submitButtonProps: {\n          loading: submitButtonLoading\n        }\n      }\n    };\n  }, [submitButtonLoading]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames((_classNames = {}, _defineProperty(_classNames, getPrefixCls('pro-card'), true), _defineProperty(_classNames, \"\".concat(getPrefixCls('pro-card'), \"-border\"), !!bordered), _defineProperty(_classNames, \"\".concat(getPrefixCls('pro-card'), \"-bordered\"), !!bordered), _defineProperty(_classNames, \"\".concat(getPrefixCls('pro-card'), \"-ghost\"), !!ghost), _defineProperty(_classNames, className, true), _defineProperty(_classNames, formClassName, isForm), _defineProperty(_classNames, getPrefixCls(\"pro-table-search-\".concat(toLowerLine(competentName))), true), _defineProperty(_classNames, \"\".concat(className, \"-ghost\"), ghost), _defineProperty(_classNames, searchConfig === null || searchConfig === void 0 ? void 0 : searchConfig.className, searchConfig !== false && (searchConfig === null || searchConfig === void 0 ? void 0 : searchConfig.className)), _classNames))\n  }, /*#__PURE__*/React.createElement(BetaSchemaForm, _extends({\n    layoutType: competentName,\n    columns: columnsList,\n    type: type\n  }, loadingProps, getFromProps(isForm, searchConfig, competentName), getFormConfigs(isForm, formConfig || {}), {\n    formRef: formRef,\n    action: action,\n    dateFormatter: dateFormatter,\n    onInit: function onInit(values) {\n      // 触发一个 submit，之所以这里触发是为了保证 value 都被 format了\n      if (type !== 'form') {\n        var _action$current, _action$current2, _action$current2$setP;\n\n        // 修改 pageSize，变成从 url 中获取的\n        var pageInfo = (_action$current = action.current) === null || _action$current === void 0 ? void 0 : _action$current.pageInfo; // 从 values 里获取是因为有时候要从 url中获取的 pageSize。\n\n        var _values$current = values.current,\n            current = _values$current === void 0 ? pageInfo === null || pageInfo === void 0 ? void 0 : pageInfo.current : _values$current,\n            _values$pageSize = values.pageSize,\n            pageSize = _values$pageSize === void 0 ? pageInfo === null || pageInfo === void 0 ? void 0 : pageInfo.pageSize : _values$pageSize;\n        (_action$current2 = action.current) === null || _action$current2 === void 0 ? void 0 : (_action$current2$setP = _action$current2.setPageInfo) === null || _action$current2$setP === void 0 ? void 0 : _action$current2$setP.call(_action$current2, _objectSpread(_objectSpread({}, pageInfo), {}, {\n          current: parseInt(current, 10),\n          pageSize: parseInt(pageSize, 10)\n        }));\n        /** 如果是手动模式不需要提交 */\n\n        if (manualRequest) return;\n        submit(values, true);\n      }\n    },\n    onReset: function onReset(values) {\n      _onReset === null || _onReset === void 0 ? void 0 : _onReset(values);\n    },\n    onFinish: function onFinish(values) {\n      submit(values, false);\n    },\n    initialValues: formConfig === null || formConfig === void 0 ? void 0 : formConfig.initialValues\n  })));\n};\n\nexport default FormRender;"]},"metadata":{},"sourceType":"module"}