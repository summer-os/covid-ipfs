{"ast":null,"code":"import \"antd/es/drawer/style\";\nimport _Drawer from \"antd/es/drawer\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime/helpers/esm/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport \"antd/es/config-provider/style\";\nimport _ConfigProvider from \"antd/es/config-provider\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _excluded = [\"children\", \"trigger\", \"onVisibleChange\", \"drawerProps\", \"onFinish\", \"submitTimeout\", \"title\", \"width\", \"visible\"];\nimport { useRefFunction } from '@ant-design/pro-utils';\nimport merge from 'lodash/merge';\nimport useMergedState from \"rc-util/es/hooks/useMergedState\";\nimport { noteOnce } from \"rc-util/es/warning\";\nimport React, { useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport { BaseForm } from '../../BaseForm';\n\nfunction DrawerForm(_ref) {\n  var _context$locale3, _context$locale3$Moda, _context$locale4, _context$locale4$Moda;\n\n  var children = _ref.children,\n      trigger = _ref.trigger,\n      onVisibleChange = _ref.onVisibleChange,\n      drawerProps = _ref.drawerProps,\n      onFinish = _ref.onFinish,\n      submitTimeout = _ref.submitTimeout,\n      title = _ref.title,\n      width = _ref.width,\n      propVisible = _ref.visible,\n      rest = _objectWithoutProperties(_ref, _excluded);\n\n  noteOnce( // eslint-disable-next-line @typescript-eslint/dot-notation\n  !rest['footer'] || !(drawerProps === null || drawerProps === void 0 ? void 0 : drawerProps.footer), 'DrawerForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。');\n  var context = useContext(_ConfigProvider.ConfigContext);\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      forceUpdate = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  var _useMergedState = useMergedState(!!propVisible, {\n    value: propVisible,\n    onChange: onVisibleChange\n  }),\n      _useMergedState2 = _slicedToArray(_useMergedState, 2),\n      visible = _useMergedState2[0],\n      setVisible = _useMergedState2[1];\n\n  var footerRef = useRef(null);\n  var footerDomRef = useCallback(function (element) {\n    if (footerRef.current === null && element) {\n      forceUpdate([]);\n    }\n\n    footerRef.current = element;\n  }, []);\n  var formRef = useRef();\n  useEffect(function () {\n    if (visible && propVisible) {\n      onVisibleChange === null || onVisibleChange === void 0 ? void 0 : onVisibleChange(true);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [propVisible, visible]);\n  var triggerDom = useMemo(function () {\n    if (!trigger) {\n      return null;\n    }\n\n    return /*#__PURE__*/React.cloneElement(trigger, _objectSpread(_objectSpread({\n      key: 'trigger'\n    }, trigger.props), {}, {\n      onClick: function () {\n        var _onClick = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(e) {\n          var _trigger$props, _trigger$props$onClic;\n\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  setVisible(!visible);\n                  (_trigger$props = trigger.props) === null || _trigger$props === void 0 ? void 0 : (_trigger$props$onClic = _trigger$props.onClick) === null || _trigger$props$onClic === void 0 ? void 0 : _trigger$props$onClic.call(_trigger$props, e);\n\n                case 2:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        function onClick(_x) {\n          return _onClick.apply(this, arguments);\n        }\n\n        return onClick;\n      }()\n    }));\n  }, [setVisible, trigger, visible]);\n  var submitterConfig = useMemo(function () {\n    var _context$locale$Modal, _context$locale, _context$locale$Modal2, _context$locale$Modal3, _context$locale2, _context$locale2$Moda;\n\n    if (rest.submitter === false) {\n      return false;\n    }\n\n    return merge({\n      searchConfig: {\n        submitText: (_context$locale$Modal = (_context$locale = context.locale) === null || _context$locale === void 0 ? void 0 : (_context$locale$Modal2 = _context$locale.Modal) === null || _context$locale$Modal2 === void 0 ? void 0 : _context$locale$Modal2.okText) !== null && _context$locale$Modal !== void 0 ? _context$locale$Modal : '确认',\n        resetText: (_context$locale$Modal3 = (_context$locale2 = context.locale) === null || _context$locale2 === void 0 ? void 0 : (_context$locale2$Moda = _context$locale2.Modal) === null || _context$locale2$Moda === void 0 ? void 0 : _context$locale2$Moda.cancelText) !== null && _context$locale$Modal3 !== void 0 ? _context$locale$Modal3 : '取消'\n      },\n      resetButtonProps: {\n        preventDefault: true,\n        // 提交表单loading时，不可关闭弹框\n        disabled: submitTimeout ? loading : undefined,\n        onClick: function onClick(e) {\n          var _drawerProps$onClose;\n\n          setVisible(false);\n          drawerProps === null || drawerProps === void 0 ? void 0 : (_drawerProps$onClose = drawerProps.onClose) === null || _drawerProps$onClose === void 0 ? void 0 : _drawerProps$onClose.call(drawerProps, e);\n        }\n      }\n    }, rest.submitter);\n  }, [(_context$locale3 = context.locale) === null || _context$locale3 === void 0 ? void 0 : (_context$locale3$Moda = _context$locale3.Modal) === null || _context$locale3$Moda === void 0 ? void 0 : _context$locale3$Moda.cancelText, (_context$locale4 = context.locale) === null || _context$locale4 === void 0 ? void 0 : (_context$locale4$Moda = _context$locale4.Modal) === null || _context$locale4$Moda === void 0 ? void 0 : _context$locale4$Moda.okText, drawerProps, rest.submitter, setVisible, loading, submitTimeout]);\n  var contentRender = useCallback(function (formDom, submitter) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, formDom, footerRef.current && submitter ? /*#__PURE__*/createPortal(submitter, footerRef.current) : submitter);\n  }, []);\n  var onFinishHandle = useRefFunction( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(values) {\n      var response, timer, result;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              response = onFinish === null || onFinish === void 0 ? void 0 : onFinish(values);\n\n              if (submitTimeout && response instanceof Promise) {\n                setLoading(true);\n                timer = setTimeout(function () {\n                  return setLoading(false);\n                }, submitTimeout);\n                response.finally(function () {\n                  clearTimeout(timer);\n                  setLoading(false);\n                });\n              }\n\n              _context2.next = 4;\n              return response;\n\n            case 4:\n              result = _context2.sent; // 返回真值，关闭弹框\n\n              if (result) {\n                setVisible(false);\n              }\n\n              return _context2.abrupt(\"return\", result);\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(_Drawer, _extends({\n    title: title,\n    width: width || 800\n  }, drawerProps, {\n    visible: visible,\n    onClose: function onClose(e) {\n      var _drawerProps$onClose2; // 提交表单loading时，阻止弹框关闭\n\n\n      if (submitTimeout && loading) return;\n      setVisible(false);\n      drawerProps === null || drawerProps === void 0 ? void 0 : (_drawerProps$onClose2 = drawerProps.onClose) === null || _drawerProps$onClose2 === void 0 ? void 0 : _drawerProps$onClose2.call(drawerProps, e);\n    },\n    footer: rest.submitter !== false && /*#__PURE__*/React.createElement(\"div\", {\n      ref: footerDomRef,\n      style: {\n        display: 'flex',\n        justifyContent: 'flex-end'\n      }\n    })\n  }), /*#__PURE__*/React.createElement(BaseForm, _extends({\n    formComponentType: \"DrawerForm\",\n    layout: \"vertical\",\n    formRef: formRef\n  }, rest, {\n    submitter: submitterConfig,\n    onFinish: /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(values) {\n        var _rest$formRef$current, _rest$formRef;\n\n        var result, form;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return onFinishHandle(values);\n\n              case 2:\n                result = _context3.sent;\n                form = (_rest$formRef$current = (_rest$formRef = rest.formRef) === null || _rest$formRef === void 0 ? void 0 : _rest$formRef.current) !== null && _rest$formRef$current !== void 0 ? _rest$formRef$current : formRef.current; // 返回真值，重置表单\n\n                if (result && form) {\n                  form.resetFields();\n                }\n\n                return _context3.abrupt(\"return\", result);\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x3) {\n        return _ref3.apply(this, arguments);\n      };\n    }(),\n    contentRender: contentRender\n  }), children)), triggerDom);\n}\n\nexport { DrawerForm };","map":{"version":3,"sources":["/Users/jameszow/Documents/RustWorkSpace/covid-ipfs/covid-ipfs-client/node_modules/@ant-design/pro-form/es/layouts/DrawerForm/index.js"],"names":["_Drawer","_extends","_regeneratorRuntime","_asyncToGenerator","_objectSpread","_slicedToArray","_ConfigProvider","_objectWithoutProperties","_excluded","useRefFunction","merge","useMergedState","noteOnce","React","useCallback","useContext","useEffect","useMemo","useRef","useState","createPortal","BaseForm","DrawerForm","_ref","_context$locale3","_context$locale3$Moda","_context$locale4","_context$locale4$Moda","children","trigger","onVisibleChange","drawerProps","onFinish","submitTimeout","title","width","propVisible","visible","rest","footer","context","ConfigContext","_useState","_useState2","forceUpdate","_useState3","_useState4","loading","setLoading","_useMergedState","value","onChange","_useMergedState2","setVisible","footerRef","footerDomRef","element","current","formRef","triggerDom","cloneElement","key","props","onClick","_onClick","mark","_callee","e","_trigger$props","_trigger$props$onClic","wrap","_callee$","_context","prev","next","call","stop","_x","apply","arguments","submitterConfig","_context$locale$Modal","_context$locale","_context$locale$Modal2","_context$locale$Modal3","_context$locale2","_context$locale2$Moda","submitter","searchConfig","submitText","locale","Modal","okText","resetText","cancelText","resetButtonProps","preventDefault","disabled","undefined","_drawerProps$onClose","onClose","contentRender","formDom","createElement","Fragment","onFinishHandle","_ref2","_callee2","values","response","timer","result","_callee2$","_context2","Promise","setTimeout","finally","clearTimeout","sent","abrupt","_x2","_drawerProps$onClose2","ref","style","display","justifyContent","formComponentType","layout","_ref3","_callee3","_rest$formRef$current","_rest$formRef","form","_callee3$","_context3","resetFields","_x3"],"mappings":"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","sourcesContent":["import \"antd/es/drawer/style\";\nimport _Drawer from \"antd/es/drawer\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime/helpers/esm/regeneratorRuntime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport \"antd/es/config-provider/style\";\nimport _ConfigProvider from \"antd/es/config-provider\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _excluded = [\"children\", \"trigger\", \"onVisibleChange\", \"drawerProps\", \"onFinish\", \"submitTimeout\", \"title\", \"width\", \"visible\"];\nimport { useRefFunction } from '@ant-design/pro-utils';\nimport merge from 'lodash/merge';\nimport useMergedState from \"rc-util/es/hooks/useMergedState\";\nimport { noteOnce } from \"rc-util/es/warning\";\nimport React, { useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport { BaseForm } from '../../BaseForm';\n\nfunction DrawerForm(_ref) {\n  var _context$locale3, _context$locale3$Moda, _context$locale4, _context$locale4$Moda;\n\n  var children = _ref.children,\n      trigger = _ref.trigger,\n      onVisibleChange = _ref.onVisibleChange,\n      drawerProps = _ref.drawerProps,\n      onFinish = _ref.onFinish,\n      submitTimeout = _ref.submitTimeout,\n      title = _ref.title,\n      width = _ref.width,\n      propVisible = _ref.visible,\n      rest = _objectWithoutProperties(_ref, _excluded);\n\n  noteOnce( // eslint-disable-next-line @typescript-eslint/dot-notation\n  !rest['footer'] || !(drawerProps === null || drawerProps === void 0 ? void 0 : drawerProps.footer), 'DrawerForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。');\n  var context = useContext(_ConfigProvider.ConfigContext);\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      forceUpdate = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  var _useMergedState = useMergedState(!!propVisible, {\n    value: propVisible,\n    onChange: onVisibleChange\n  }),\n      _useMergedState2 = _slicedToArray(_useMergedState, 2),\n      visible = _useMergedState2[0],\n      setVisible = _useMergedState2[1];\n\n  var footerRef = useRef(null);\n  var footerDomRef = useCallback(function (element) {\n    if (footerRef.current === null && element) {\n      forceUpdate([]);\n    }\n\n    footerRef.current = element;\n  }, []);\n  var formRef = useRef();\n  useEffect(function () {\n    if (visible && propVisible) {\n      onVisibleChange === null || onVisibleChange === void 0 ? void 0 : onVisibleChange(true);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [propVisible, visible]);\n  var triggerDom = useMemo(function () {\n    if (!trigger) {\n      return null;\n    }\n\n    return /*#__PURE__*/React.cloneElement(trigger, _objectSpread(_objectSpread({\n      key: 'trigger'\n    }, trigger.props), {}, {\n      onClick: function () {\n        var _onClick = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(e) {\n          var _trigger$props, _trigger$props$onClic;\n\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  setVisible(!visible);\n                  (_trigger$props = trigger.props) === null || _trigger$props === void 0 ? void 0 : (_trigger$props$onClic = _trigger$props.onClick) === null || _trigger$props$onClic === void 0 ? void 0 : _trigger$props$onClic.call(_trigger$props, e);\n\n                case 2:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        function onClick(_x) {\n          return _onClick.apply(this, arguments);\n        }\n\n        return onClick;\n      }()\n    }));\n  }, [setVisible, trigger, visible]);\n  var submitterConfig = useMemo(function () {\n    var _context$locale$Modal, _context$locale, _context$locale$Modal2, _context$locale$Modal3, _context$locale2, _context$locale2$Moda;\n\n    if (rest.submitter === false) {\n      return false;\n    }\n\n    return merge({\n      searchConfig: {\n        submitText: (_context$locale$Modal = (_context$locale = context.locale) === null || _context$locale === void 0 ? void 0 : (_context$locale$Modal2 = _context$locale.Modal) === null || _context$locale$Modal2 === void 0 ? void 0 : _context$locale$Modal2.okText) !== null && _context$locale$Modal !== void 0 ? _context$locale$Modal : '确认',\n        resetText: (_context$locale$Modal3 = (_context$locale2 = context.locale) === null || _context$locale2 === void 0 ? void 0 : (_context$locale2$Moda = _context$locale2.Modal) === null || _context$locale2$Moda === void 0 ? void 0 : _context$locale2$Moda.cancelText) !== null && _context$locale$Modal3 !== void 0 ? _context$locale$Modal3 : '取消'\n      },\n      resetButtonProps: {\n        preventDefault: true,\n        // 提交表单loading时，不可关闭弹框\n        disabled: submitTimeout ? loading : undefined,\n        onClick: function onClick(e) {\n          var _drawerProps$onClose;\n\n          setVisible(false);\n          drawerProps === null || drawerProps === void 0 ? void 0 : (_drawerProps$onClose = drawerProps.onClose) === null || _drawerProps$onClose === void 0 ? void 0 : _drawerProps$onClose.call(drawerProps, e);\n        }\n      }\n    }, rest.submitter);\n  }, [(_context$locale3 = context.locale) === null || _context$locale3 === void 0 ? void 0 : (_context$locale3$Moda = _context$locale3.Modal) === null || _context$locale3$Moda === void 0 ? void 0 : _context$locale3$Moda.cancelText, (_context$locale4 = context.locale) === null || _context$locale4 === void 0 ? void 0 : (_context$locale4$Moda = _context$locale4.Modal) === null || _context$locale4$Moda === void 0 ? void 0 : _context$locale4$Moda.okText, drawerProps, rest.submitter, setVisible, loading, submitTimeout]);\n  var contentRender = useCallback(function (formDom, submitter) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, formDom, footerRef.current && submitter ? /*#__PURE__*/createPortal(submitter, footerRef.current) : submitter);\n  }, []);\n  var onFinishHandle = useRefFunction( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(values) {\n      var response, timer, result;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              response = onFinish === null || onFinish === void 0 ? void 0 : onFinish(values);\n\n              if (submitTimeout && response instanceof Promise) {\n                setLoading(true);\n                timer = setTimeout(function () {\n                  return setLoading(false);\n                }, submitTimeout);\n                response.finally(function () {\n                  clearTimeout(timer);\n                  setLoading(false);\n                });\n              }\n\n              _context2.next = 4;\n              return response;\n\n            case 4:\n              result = _context2.sent;\n\n              // 返回真值，关闭弹框\n              if (result) {\n                setVisible(false);\n              }\n\n              return _context2.abrupt(\"return\", result);\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(_Drawer, _extends({\n    title: title,\n    width: width || 800\n  }, drawerProps, {\n    visible: visible,\n    onClose: function onClose(e) {\n      var _drawerProps$onClose2;\n\n      // 提交表单loading时，阻止弹框关闭\n      if (submitTimeout && loading) return;\n      setVisible(false);\n      drawerProps === null || drawerProps === void 0 ? void 0 : (_drawerProps$onClose2 = drawerProps.onClose) === null || _drawerProps$onClose2 === void 0 ? void 0 : _drawerProps$onClose2.call(drawerProps, e);\n    },\n    footer: rest.submitter !== false && /*#__PURE__*/React.createElement(\"div\", {\n      ref: footerDomRef,\n      style: {\n        display: 'flex',\n        justifyContent: 'flex-end'\n      }\n    })\n  }), /*#__PURE__*/React.createElement(BaseForm, _extends({\n    formComponentType: \"DrawerForm\",\n    layout: \"vertical\",\n    formRef: formRef\n  }, rest, {\n    submitter: submitterConfig,\n    onFinish: /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(values) {\n        var _rest$formRef$current, _rest$formRef;\n\n        var result, form;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return onFinishHandle(values);\n\n              case 2:\n                result = _context3.sent;\n                form = (_rest$formRef$current = (_rest$formRef = rest.formRef) === null || _rest$formRef === void 0 ? void 0 : _rest$formRef.current) !== null && _rest$formRef$current !== void 0 ? _rest$formRef$current : formRef.current; // 返回真值，重置表单\n\n                if (result && form) {\n                  form.resetFields();\n                }\n\n                return _context3.abrupt(\"return\", result);\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x3) {\n        return _ref3.apply(this, arguments);\n      };\n    }(),\n    contentRender: contentRender\n  }), children)), triggerDom);\n}\n\nexport { DrawerForm };"]},"metadata":{},"sourceType":"module"}