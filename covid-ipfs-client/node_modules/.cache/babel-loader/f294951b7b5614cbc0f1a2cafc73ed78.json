{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _excluded = [\"columns\", \"layoutType\", \"type\", \"action\", \"shouldUpdate\"];\nimport { LabelIconTip, omitUndefined, runFunction, useLatest } from '@ant-design/pro-utils';\nimport omit from 'omit.js';\nimport React, { useCallback, useImperativeHandle, useMemo, useRef, useState } from 'react';\nimport { DrawerForm } from '../../layouts/DrawerForm';\nimport { LightFilter } from '../../layouts/LightFilter';\nimport { ModalForm } from '../../layouts/ModalForm';\nimport { ProForm } from '../../layouts/ProForm';\nimport { QueryFilter } from '../../layouts/QueryFilter';\nimport { StepsForm as ProStepsForm } from '../../layouts/StepsForm';\nimport { Embed, StepsForm } from './layoutType';\nimport { renderValueType } from './valueType';\nexport * from './typing';\nvar FormLayoutType = {\n  DrawerForm: DrawerForm,\n  QueryFilter: QueryFilter,\n  LightFilter: LightFilter,\n  StepForm: ProStepsForm.StepForm,\n  StepsForm: StepsForm,\n  ModalForm: ModalForm,\n  Embed: Embed\n};\n/**\n * 此组件可以根据 Json Schema 来生成相应的表单,大部分配置与 antd 的 table 列配置相同\n *\n * @see 此组件仍为 beta 版本，api 可能发生变化\n */\n\nfunction BetaSchemaForm(props) {\n  var columns = props.columns,\n      _props$layoutType = props.layoutType,\n      layoutType = _props$layoutType === void 0 ? 'Form' : _props$layoutType,\n      _props$type = props.type,\n      type = _props$type === void 0 ? 'form' : _props$type,\n      action = props.action,\n      _props$shouldUpdate = props.shouldUpdate,\n      shouldUpdate = _props$shouldUpdate === void 0 ? true : _props$shouldUpdate,\n      restProps = _objectWithoutProperties(props, _excluded);\n\n  var FormRenderComponents = FormLayoutType[layoutType] || ProForm;\n\n  var _Form$useForm = _Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      form = _Form$useForm2[0];\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      forceUpdate = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      formDomsDeps = _useState4[0],\n      updatedFormDoms = _useState4[1];\n\n  var rest = useMemo(function () {\n    return omit(restProps, ['formRef']);\n  }, [restProps]);\n  var formRef = useRef(props.form || form);\n  var oldValuesRef = useRef();\n  var propsRef = useLatest(props);\n  useImperativeHandle(restProps.formRef, function () {\n    return formRef.current;\n  });\n  /**\n   * 生成子项，方便被 table 接入\n   *\n   * @param items\n   */\n\n  var genItems = useCallback(function (items) {\n    return items.filter(function (originItem) {\n      return !(originItem.hideInForm && type === 'form');\n    }).sort(function (a, b) {\n      if (b.order || a.order) {\n        return (b.order || 0) - (a.order || 0);\n      }\n\n      return (b.index || 0) - (a.index || 0);\n    }).map(function (originItem, index) {\n      var _item$dataIndex;\n\n      var title = runFunction(originItem.title, originItem, 'form', /*#__PURE__*/React.createElement(LabelIconTip, {\n        label: originItem.title,\n        tooltip: originItem.tooltip || originItem.tip\n      }));\n      var item = omitUndefined({\n        title: title,\n        label: title,\n        name: originItem.name,\n        valueType: runFunction(originItem.valueType, {}),\n        key: originItem.key,\n        columns: originItem.columns,\n        valueEnum: originItem.valueEnum,\n        dataIndex: originItem.key || originItem.dataIndex,\n        initialValue: originItem.initialValue,\n        width: originItem.width,\n        index: originItem.index,\n        readonly: originItem.readonly,\n        colSize: originItem.colSize,\n        colProps: originItem.colProps,\n        rowProps: originItem.rowProps,\n        className: originItem.className,\n        tooltip: originItem.tooltip || originItem.tip,\n        dependencies: originItem.dependencies,\n        proFieldProps: originItem.proFieldProps,\n        ignoreFormItem: originItem.ignoreFormItem,\n        getFieldProps: originItem.fieldProps ? function () {\n          return runFunction(originItem.fieldProps, formRef.current, originItem);\n        } : undefined,\n        getFormItemProps: originItem.formItemProps ? function () {\n          return runFunction(originItem.formItemProps, formRef.current, originItem);\n        } : undefined,\n        render: originItem.render,\n        renderFormItem: originItem.renderFormItem,\n        renderText: originItem.renderText,\n        request: originItem.request,\n        params: originItem.params,\n        transform: originItem.transform,\n        convertValue: originItem.convertValue\n      });\n      item.key = item.key || ((_item$dataIndex = item.dataIndex) === null || _item$dataIndex === void 0 ? void 0 : _item$dataIndex.toString()) || index;\n      return renderValueType(item, {\n        action: action,\n        type: type,\n        originItem: originItem,\n        formRef: formRef,\n        genItems: genItems\n      });\n    }).filter(function (field) {\n      return Boolean(field);\n    });\n  }, [action, formRef, type]);\n  var onValuesChange = useCallback(function (changedValues, values) {\n    var propsOnValuesChange = propsRef.current.onValuesChange;\n\n    if (shouldUpdate === true || typeof shouldUpdate === 'function' && shouldUpdate(values, oldValuesRef.current)) {\n      updatedFormDoms([]);\n    }\n\n    oldValuesRef.current = values;\n    propsOnValuesChange === null || propsOnValuesChange === void 0 ? void 0 : propsOnValuesChange(changedValues, values);\n  }, [propsRef, shouldUpdate]);\n  var formChildrenDoms = useMemo(function () {\n    if (!formRef.current) return; // like StepsForm's columns but not only for StepsForm\n\n    if (columns.length && Array.isArray(columns[0])) return;\n    return genItems(columns); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [columns, genItems, formDomsDeps]);\n  /**\n   * Append layoutType component specific props\n   */\n\n  var specificProps = useMemo(function () {\n    if (layoutType === 'StepsForm') {\n      return {\n        forceUpdate: forceUpdate,\n        columns: columns\n      };\n    }\n\n    return {};\n  }, [columns, layoutType]);\n  return /*#__PURE__*/React.createElement(FormRenderComponents, _extends({}, specificProps, rest, {\n    form: props.form || form,\n    formRef: formRef,\n    onValuesChange: onValuesChange\n  }), formChildrenDoms);\n}\n\nexport default BetaSchemaForm;","map":{"version":3,"sources":["/Users/jameszow/Documents/RustWorkSpace/covid-ipfs/covid-ipfs-client/node_modules/@ant-design/pro-form/es/components/SchemaForm/index.js"],"names":["_extends","_Form","_slicedToArray","_objectWithoutProperties","_excluded","LabelIconTip","omitUndefined","runFunction","useLatest","omit","React","useCallback","useImperativeHandle","useMemo","useRef","useState","DrawerForm","LightFilter","ModalForm","ProForm","QueryFilter","StepsForm","ProStepsForm","Embed","renderValueType","FormLayoutType","StepForm","BetaSchemaForm","props","columns","_props$layoutType","layoutType","_props$type","type","action","_props$shouldUpdate","shouldUpdate","restProps","FormRenderComponents","_Form$useForm","useForm","_Form$useForm2","form","_useState","_useState2","forceUpdate","_useState3","_useState4","formDomsDeps","updatedFormDoms","rest","formRef","oldValuesRef","propsRef","current","genItems","items","filter","originItem","hideInForm","sort","a","b","order","index","map","_item$dataIndex","title","createElement","label","tooltip","tip","item","name","valueType","key","valueEnum","dataIndex","initialValue","width","readonly","colSize","colProps","rowProps","className","dependencies","proFieldProps","ignoreFormItem","getFieldProps","fieldProps","undefined","getFormItemProps","formItemProps","render","renderFormItem","renderText","request","params","transform","convertValue","toString","field","Boolean","onValuesChange","changedValues","values","propsOnValuesChange","formChildrenDoms","length","Array","isArray","specificProps"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _excluded = [\"columns\", \"layoutType\", \"type\", \"action\", \"shouldUpdate\"];\nimport { LabelIconTip, omitUndefined, runFunction, useLatest } from '@ant-design/pro-utils';\nimport omit from 'omit.js';\nimport React, { useCallback, useImperativeHandle, useMemo, useRef, useState } from 'react';\nimport { DrawerForm } from '../../layouts/DrawerForm';\nimport { LightFilter } from '../../layouts/LightFilter';\nimport { ModalForm } from '../../layouts/ModalForm';\nimport { ProForm } from '../../layouts/ProForm';\nimport { QueryFilter } from '../../layouts/QueryFilter';\nimport { StepsForm as ProStepsForm } from '../../layouts/StepsForm';\nimport { Embed, StepsForm } from './layoutType';\nimport { renderValueType } from './valueType';\nexport * from './typing';\nvar FormLayoutType = {\n  DrawerForm: DrawerForm,\n  QueryFilter: QueryFilter,\n  LightFilter: LightFilter,\n  StepForm: ProStepsForm.StepForm,\n  StepsForm: StepsForm,\n  ModalForm: ModalForm,\n  Embed: Embed\n};\n/**\n * 此组件可以根据 Json Schema 来生成相应的表单,大部分配置与 antd 的 table 列配置相同\n *\n * @see 此组件仍为 beta 版本，api 可能发生变化\n */\n\nfunction BetaSchemaForm(props) {\n  var columns = props.columns,\n      _props$layoutType = props.layoutType,\n      layoutType = _props$layoutType === void 0 ? 'Form' : _props$layoutType,\n      _props$type = props.type,\n      type = _props$type === void 0 ? 'form' : _props$type,\n      action = props.action,\n      _props$shouldUpdate = props.shouldUpdate,\n      shouldUpdate = _props$shouldUpdate === void 0 ? true : _props$shouldUpdate,\n      restProps = _objectWithoutProperties(props, _excluded);\n\n  var FormRenderComponents = FormLayoutType[layoutType] || ProForm;\n\n  var _Form$useForm = _Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      form = _Form$useForm2[0];\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      forceUpdate = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      formDomsDeps = _useState4[0],\n      updatedFormDoms = _useState4[1];\n\n  var rest = useMemo(function () {\n    return omit(restProps, ['formRef']);\n  }, [restProps]);\n  var formRef = useRef(props.form || form);\n  var oldValuesRef = useRef();\n  var propsRef = useLatest(props);\n  useImperativeHandle(restProps.formRef, function () {\n    return formRef.current;\n  });\n  /**\n   * 生成子项，方便被 table 接入\n   *\n   * @param items\n   */\n\n  var genItems = useCallback(function (items) {\n    return items.filter(function (originItem) {\n      return !(originItem.hideInForm && type === 'form');\n    }).sort(function (a, b) {\n      if (b.order || a.order) {\n        return (b.order || 0) - (a.order || 0);\n      }\n\n      return (b.index || 0) - (a.index || 0);\n    }).map(function (originItem, index) {\n      var _item$dataIndex;\n\n      var title = runFunction(originItem.title, originItem, 'form', /*#__PURE__*/React.createElement(LabelIconTip, {\n        label: originItem.title,\n        tooltip: originItem.tooltip || originItem.tip\n      }));\n      var item = omitUndefined({\n        title: title,\n        label: title,\n        name: originItem.name,\n        valueType: runFunction(originItem.valueType, {}),\n        key: originItem.key,\n        columns: originItem.columns,\n        valueEnum: originItem.valueEnum,\n        dataIndex: originItem.key || originItem.dataIndex,\n        initialValue: originItem.initialValue,\n        width: originItem.width,\n        index: originItem.index,\n        readonly: originItem.readonly,\n        colSize: originItem.colSize,\n        colProps: originItem.colProps,\n        rowProps: originItem.rowProps,\n        className: originItem.className,\n        tooltip: originItem.tooltip || originItem.tip,\n        dependencies: originItem.dependencies,\n        proFieldProps: originItem.proFieldProps,\n        ignoreFormItem: originItem.ignoreFormItem,\n        getFieldProps: originItem.fieldProps ? function () {\n          return runFunction(originItem.fieldProps, formRef.current, originItem);\n        } : undefined,\n        getFormItemProps: originItem.formItemProps ? function () {\n          return runFunction(originItem.formItemProps, formRef.current, originItem);\n        } : undefined,\n        render: originItem.render,\n        renderFormItem: originItem.renderFormItem,\n        renderText: originItem.renderText,\n        request: originItem.request,\n        params: originItem.params,\n        transform: originItem.transform,\n        convertValue: originItem.convertValue\n      });\n      item.key = item.key || ((_item$dataIndex = item.dataIndex) === null || _item$dataIndex === void 0 ? void 0 : _item$dataIndex.toString()) || index;\n      return renderValueType(item, {\n        action: action,\n        type: type,\n        originItem: originItem,\n        formRef: formRef,\n        genItems: genItems\n      });\n    }).filter(function (field) {\n      return Boolean(field);\n    });\n  }, [action, formRef, type]);\n  var onValuesChange = useCallback(function (changedValues, values) {\n    var propsOnValuesChange = propsRef.current.onValuesChange;\n\n    if (shouldUpdate === true || typeof shouldUpdate === 'function' && shouldUpdate(values, oldValuesRef.current)) {\n      updatedFormDoms([]);\n    }\n\n    oldValuesRef.current = values;\n    propsOnValuesChange === null || propsOnValuesChange === void 0 ? void 0 : propsOnValuesChange(changedValues, values);\n  }, [propsRef, shouldUpdate]);\n  var formChildrenDoms = useMemo(function () {\n    if (!formRef.current) return; // like StepsForm's columns but not only for StepsForm\n\n    if (columns.length && Array.isArray(columns[0])) return;\n    return genItems(columns); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [columns, genItems, formDomsDeps]);\n  /**\n   * Append layoutType component specific props\n   */\n\n  var specificProps = useMemo(function () {\n    if (layoutType === 'StepsForm') {\n      return {\n        forceUpdate: forceUpdate,\n        columns: columns\n      };\n    }\n\n    return {};\n  }, [columns, layoutType]);\n  return /*#__PURE__*/React.createElement(FormRenderComponents, _extends({}, specificProps, rest, {\n    form: props.form || form,\n    formRef: formRef,\n    onValuesChange: onValuesChange\n  }), formChildrenDoms);\n}\n\nexport default BetaSchemaForm;"]},"metadata":{},"sourceType":"module"}